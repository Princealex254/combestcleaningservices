<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>COMBEST Admin Panel</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .admin-container {
            display: flex;
            min-height: 100vh;
        }

        .sidebar {
            width: 250px;
            background: linear-gradient(135deg, #2c3e50, #34495e);
            color: white;
            padding: 20px 0;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            transition: all 0.3s ease;
        }

        .sidebar.closed {
            width: 60px;
        }

        .sidebar-header {
            padding: 0 20px 20px;
            border-bottom: 1px solid #34495e;
            margin-bottom: 20px;
        }

        .sidebar-header h2 {
            color: #57b846;
            font-size: 1.5rem;
            transition: all 0.3s ease;
        }

        .sidebar.closed .sidebar-header h2 {
            opacity: 0;
        }

        .sidebar-menu {
            list-style: none;
        }

        .sidebar-menu li {
            margin-bottom: 5px;
        }

        .sidebar-menu a {
            display: flex;
            align-items: center;
            padding: 15px 20px;
            color: #bdc3c7;
            text-decoration: none;
            transition: all 0.3s ease;
            border-left: 3px solid transparent;
        }

        .sidebar-menu a:hover,
        .sidebar-menu a.active {
            background: rgba(87, 184, 70, 0.1);
            color: #57b846;
            border-left-color: #57b846;
        }

        .sidebar-menu a i {
            margin-right: 15px;
            font-size: 1.2rem;
            width: 20px;
        }

        .sidebar.closed .sidebar-menu a span {
            display: none;
        }

        .main-content {
            flex: 1;
            margin-left: 250px;
            padding: 20px;
            transition: all 0.3s ease;
        }

        .main-content.expanded {
            margin-left: 60px;
        }

        .header {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            color: #2c3e50;
            font-size: 2rem;
        }

        .welcome-text {
            color: #57b846;
            font-weight: 600;
        }

        .logout-btn {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .logout-btn:hover {
            background: #c0392b;
            transform: translateY(-2px);
        }

        .content-section {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .section-title {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.5rem;
            border-bottom: 2px solid #57b846;
            padding-bottom: 10px;
        }

        .add-btn {
            background: #57b846;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }

        .add-btn:hover {
            background: #4a9e3a;
            transform: translateY(-2px);
        }

        .data-grid {
            display: grid;
            gap: 15px;
        }

        .data-card {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #57b846;
            transition: all 0.3s ease;
        }

        .data-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .card-title {
            font-weight: 600;
            color: #2c3e50;
        }

        .card-actions {
            display: flex;
            gap: 10px;
        }

        .btn {
            padding: 5px 10px;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            font-size: 0.8rem;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn-edit {
            background: #3498db;
            color: white;
        }

        .btn-delete {
            background: #e74c3c;
            color: white;
        }

        .btn-hide {
            background: #f39c12;
            color: white;
        }

        .btn-show {
            background: #27ae60;
            color: white;
        }

        .btn:hover {
            transform: translateY(-1px);
            opacity: 0.9;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: white;
            margin: 5% auto;
            padding: 20px;
            border-radius: 10px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #57b846;
        }

        .modal-title {
            color: #2c3e50;
            font-size: 1.5rem;
        }

        .close-btn {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 1.2rem;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #2c3e50;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 10px;
            border: 2px solid #e1e5e9;
            border-radius: 5px;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #57b846;
            box-shadow: 0 0 0 3px rgba(87, 184, 70, 0.1);
        }

        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }

        .image-preview {
            width: 100%;
            max-width: 200px;
            height: 150px;
            object-fit: cover;
            border-radius: 8px;
            margin-top: 10px;
            border: 2px solid #e1e5e9;
        }

        .submit-btn {
            background: #57b846;
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            font-size: 1rem;
            transition: all 0.3s ease;
            width: 100%;
        }

        .submit-btn:hover {
            background: #4a9e3a;
            transform: translateY(-2px);
        }

        .success-message,
        .error-message {
            position: fixed;
            top: 30px;
            right: 30px;
            padding: 20px 25px;
            padding-right: 50px;
            border-radius: 12px;
            color: white;
            font-weight: 600;
            font-size: 1rem;
            z-index: 9999;
            box-shadow: 0 10px 30px rgba(0,0,0,0.4);
            transform: translateX(500px);
            transition: all 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            max-width: 400px;
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255,255,255,0.3);
            opacity: 0;
            pointer-events: none;
            cursor: pointer;
        }

        .success-message.show,
        .error-message.show {
            transform: translateX(0);
            opacity: 1;
            pointer-events: auto;
        }

        .success-message {
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            border-left: 5px solid #1e8449;
        }

        .error-message {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            border-left: 5px solid #a93226;
        }

        .message-icon {
            display: inline-block;
            margin-right: 10px;
            font-size: 1.2rem;
        }

        .message-content {
            display: inline-block;
            vertical-align: top;
        }

        .message-close {
            position: absolute;
            top: 10px;
            right: 15px;
            background: none;
            border: none;
            color: white;
            font-size: 1.2rem;
            cursor: pointer;
            opacity: 0.7;
            transition: opacity 0.3s ease;
        }

        .message-close:hover {
            opacity: 1;
        }

        .job-header {
            background: linear-gradient(135deg, #57b846, #4a9e3a);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 15px rgba(87, 184, 70, 0.3);
        }

        .job-title {
            font-size: 1.4rem;
            font-weight: 700;
            margin: 0;
        }

        .application-count {
            background: rgba(255, 255, 255, 0.2);
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .application-card {
            margin-left: 20px;
            border-left: 4px solid #57b846;
            background: linear-gradient(135deg, #f8f9fa, #ffffff);
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            transition: all 0.3s ease;
            overflow: hidden;
        }

        .application-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }

        .application-details {
            margin-top: 15px;
        }

        .application-details p {
            margin-bottom: 8px;
            color: #333;
        }

        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .status-pending {
            background: #fff3cd;
            color: #856404;
        }

        .status-reviewed {
            background: #d1ecf1;
            color: #0c5460;
        }

        .status-accepted {
            background: #d4edda;
            color: #155724;
        }

        .status-rejected {
            background: #f8d7da;
            color: #721c24;
        }

        .status-visible {
            background: #d4edda;
            color: #155724;
        }

        .status-hidden {
            background: #f8d7da;
            color: #721c24;
        }

        .no-data-card {
            text-align: center;
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border: 2px dashed #bdc3c7;
        }

        .no-data-content h3 {
            color: #6c757d;
            margin-bottom: 10px;
        }

        .no-data-content p {
            color: #6c757d;
            margin: 0;
        }

        .subsection {
            margin-bottom: 40px;
        }

        .applications-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
        }

        .applications-header .section-title {
            color: white;
            margin-bottom: 25px;
            font-size: 2rem;
            font-weight: 700;
        }

        .applications-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            padding: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: translateY(-2px);
        }

        .stat-icon {
            font-size: 2.5rem;
            opacity: 0.9;
        }

        .stat-content {
            flex: 1;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.9rem;
            opacity: 0.9;
            font-weight: 500;
        }

        .subsection-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e1e5e9;
        }

        .subsection-title {
            color: #2c3e50;
            font-size: 1.3rem;
            font-weight: 600;
            margin: 0;
        }

        .subsection-actions {
            display: flex;
            gap: 10px;
        }

        .subsection-filters {
            display: flex;
            gap: 10px;
        }

        .filter-select {
            padding: 8px 15px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            background: white;
            color: #2c3e50;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .filter-select:focus {
            outline: none;
            border-color: #57b846;
            box-shadow: 0 0 0 3px rgba(87, 184, 70, 0.1);
        }

        .btn-icon {
            margin-right: 8px;
        }

        .job-posting-card {
            background: linear-gradient(135deg, #f8f9fa, #ffffff);
            border-left: 4px solid #3498db;
            margin-bottom: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            transition: all 0.3s ease;
            overflow: hidden;
        }

        .job-posting-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }

        .job-posting-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .job-posting-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: #2c3e50;
        }

        .job-posting-actions {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .application-stats {
            background: rgba(52, 152, 219, 0.1);
            padding: 8px 15px;
            border-radius: 15px;
            font-size: 0.9rem;
            color: #2980b9;
            font-weight: 600;
        }

        .job-details {
            margin-top: 15px;
        }

        .job-details p {
            margin-bottom: 8px;
            color: #333;
        }

        .mobile-menu-btn {
            display: none;
            background: #57b846;
            color: white;
            border: none;
            padding: 12px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.4rem;
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 1001;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            transition: all 0.3s ease;
            width: 48px;
            height: 48px;
            align-items: center;
            justify-content: center;
        }

        .mobile-menu-btn:hover {
            background: #4a9d3a;
            transform: scale(1.05);
        }

        .mobile-menu-btn:active {
            transform: scale(0.95);
        }

        /* Hamburger animation */
        .hamburger {
            display: flex;
            flex-direction: column;
            width: 20px;
            height: 16px;
            justify-content: space-between;
            cursor: pointer;
        }

        .hamburger span {
            display: block;
            height: 2px;
            width: 100%;
            background: white;
            border-radius: 1px;
            transition: all 0.3s ease;
        }

        .hamburger.active span:nth-child(1) {
            transform: rotate(45deg) translate(5px, 5px);
        }

        .hamburger.active span:nth-child(2) {
            opacity: 0;
        }

        .hamburger.active span:nth-child(3) {
            transform: rotate(-45deg) translate(7px, -6px);
        }

        /* Mobile sidebar overlay */
        .sidebar-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 999;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .sidebar-overlay.show {
            display: block;
            opacity: 1;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #57b846, #4a9e3a);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(87, 184, 70, 0.3);
        }

        .stat-number {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .login-form {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            z-index: 2000;
            justify-content: center;
            align-items: center;
        }

        .login-form.show {
            display: flex;
        }

        .login-container {
            background: white;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
            width: 90%;
            max-width: 400px;
            text-align: center;
        }

        .login-logo {
            width: 80px;
            height: 80px;
            margin: 0 auto 20px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            object-fit: cover;
        }

        .login-title {
            color: #2c3e50;
            font-size: 2rem;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .login-subtitle {
            color: #7f8c8d;
            margin-bottom: 30px;
            font-size: 1rem;
        }

        .login-input {
            width: 100%;
            padding: 15px;
            margin-bottom: 20px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .login-input:focus {
            outline: none;
            border-color: #57b846;
            box-shadow: 0 0 0 3px rgba(87, 184, 70, 0.1);
        }

        .login-btn {
            width: 100%;
            background: #57b846;
            color: white;
            border: none;
            padding: 15px;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 20px;
        }

        .login-btn:hover {
            background: #4a9e3a;
            transform: translateY(-2px);
        }

        .login-btn:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
            transform: none;
        }

        .login-error {
            color: #e74c3c;
            font-size: 0.9rem;
            margin-top: 10px;
            display: none;
        }

        /* Activity Table Styles */
        .activity-table-container {
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
            margin-bottom: 20px;
        }

        .activity-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9rem;
        }

        .activity-table thead {
            background: linear-gradient(135deg, #57b846, #4a9e3a);
            color: white;
        }

        .activity-table th {
            padding: 15px 12px;
            text-align: left;
            font-weight: 600;
            border-bottom: 2px solid #4a9e3a;
        }

        .activity-table td {
            padding: 12px;
            border-bottom: 1px solid #e1e5e9;
            vertical-align: top;
        }

        .activity-table tbody tr:hover {
            background: #f8f9fa;
        }

        .activity-table tbody tr:nth-child(even) {
            background: #fafbfc;
        }

        .activity-table tbody tr:nth-child(even):hover {
            background: #f1f3f4;
        }

        .activity-action-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .action-login { background: #d4edda; color: #155724; }
        .action-logout { background: #f8d7da; color: #721c24; }
        .action-create { background: #d1ecf1; color: #0c5460; }
        .action-update { background: #fff3cd; color: #856404; }
        .action-delete { background: #f5c6cb; color: #721c24; }
        .action-status_change { background: #e2e3e5; color: #383d41; }
        .action-test { background: #cce5ff; color: #004085; }

        .activity-details {
            max-width: 200px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            font-size: 0.8rem;
            color: #6c757d;
        }

        .activity-admin {
            font-weight: 500;
            color: #2c3e50;
        }

        .activity-time {
            font-size: 0.85rem;
            color: #6c757d;
            white-space: nowrap;
        }

        .activity-item {
            font-weight: 500;
            color: #57b846;
        }

        /* Auto-logout notification */
        .auto-logout-warning {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, #f39c12, #e67e22);
            color: white;
            padding: 20px 30px;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            z-index: 10000;
            text-align: center;
            display: none;
        }

        .auto-logout-warning h3 {
            margin: 0 0 10px 0;
            font-size: 1.2rem;
        }

        .auto-logout-warning p {
            margin: 0 0 15px 0;
        }

        .auto-logout-warning .countdown {
            font-size: 1.5rem;
            font-weight: 700;
            color: #fff;
        }

        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
                z-index: 1000;
                box-shadow: 2px 0 10px rgba(0,0,0,0.3);
            }

            .sidebar.open {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
                padding: 80px 15px 20px 15px;
            }

            .mobile-menu-btn {
                display: flex;
            }

            .header {
                flex-direction: column;
                gap: 15px;
                margin-top: 60px;
                padding: 15px;
            }

            .header h1 {
                font-size: 1.5rem;
                text-align: center;
            }

            .stats-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .stat-card {
                padding: 15px;
            }

            .login-container {
                margin: 20px;
                padding: 30px 20px;
            }

            /* Mobile table improvements */
            .data-grid {
                gap: 15px;
            }

            .data-card {
                padding: 15px;
            }

            .card-header {
                flex-direction: column;
                gap: 10px;
                align-items: flex-start;
            }

            .card-actions {
                width: 100%;
                justify-content: space-between;
            }

            /* Mobile modal improvements */
            .modal-content {
                margin: 20px;
                max-height: calc(100vh - 40px);
                overflow-y: auto;
            }

            /* Mobile form improvements */
            .form-group {
                margin-bottom: 15px;
            }

            .form-group input,
            .form-group select,
            .form-group textarea {
                font-size: 16px; /* Prevents zoom on iOS */
            }

            /* Mobile button improvements */
            .btn {
                padding: 12px 16px;
                font-size: 14px;
                min-height: 44px; /* Touch target size */
            }

            .add-btn {
                width: 100%;
                margin-bottom: 20px;
            }

            /* Mobile sidebar menu improvements */
            .sidebar-menu a {
                padding: 18px 20px;
                font-size: 16px;
            }

            .sidebar-menu a i {
                font-size: 1.4rem;
                margin-right: 12px;
            }

            /* Mobile CV actions */
            .cv-actions {
                flex-direction: row;
                gap: 2px;
            }

            .cv-btn {
                font-size: 10px;
                padding: 2px 4px;
            }

            .cv-info {
                font-size: 9px;
                max-width: 80px;
            }

            /* Mobile applications table */
            .applications-table-container {
                max-height: 400px;
            }

            .applications-table th,
            .applications-table td {
                padding: 6px 4px;
                font-size: 11px;
            }

            .cv-cell {
                min-width: 80px;
            }

            .applications-header {
                padding: 20px;
            }

            .applications-header .section-title {
                font-size: 1.5rem;
            }

            .applications-stats {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .stat-card {
                padding: 15px;
            }

            .stat-icon {
                font-size: 2rem;
            }

            .stat-number {
                font-size: 1.5rem;
            }

            .subsection-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }

            .subsection-actions,
            .subsection-filters {
                width: 100%;
            }

            .filter-select {
                width: 100%;
            }

            .job-posting-actions {
                flex-direction: column;
                gap: 10px;
                align-items: flex-start;
            }

            .application-card {
                margin-left: 0;
            }

            .success-message,
            .error-message {
                top: 20px;
                right: 20px;
                left: 20px;
                max-width: none;
                transform: translateY(-100px);
            }

            .success-message.show,
            .error-message.show {
                transform: translateY(0);
            }

            .activity-table-container {
                overflow-x: auto;
            }

            .activity-table {
                min-width: 800px;
            }

            .activity-table th,
            .activity-table td {
                padding: 8px 6px;
                font-size: 0.8rem;
            }

            .activity-details {
                max-width: 120px;
            }

            .auto-logout-warning {
                left: 10px;
                right: 10px;
                transform: translateY(-50%);
                margin: 0;
            }
        }

        /* Application Processing Styles */
        .application-tools {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 20px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            flex-wrap: wrap;
            gap: 15px;
        }

        .tools-left {
            display: flex;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .tools-right {
            display: flex;
            align-items: center;
            gap: 10px;
            flex-wrap: wrap;
        }

        .search-box {
            position: relative;
            min-width: 250px;
        }

        .search-box input {
            width: 100%;
            padding: 10px 40px 10px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 25px;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .search-box input:focus {
            border-color: #007bff;
            outline: none;
            box-shadow: 0 0 0 3px rgba(0,123,255,0.1);
        }

        .search-icon {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #666;
        }

        .filter-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .filter-select {
            padding: 8px 12px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            background: white;
            font-size: 14px;
            min-width: 120px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .filter-select:focus {
            border-color: #007bff;
            outline: none;
        }

        .bulk-actions {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .applications-table-container {
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
            margin-bottom: 20px;
        }

        .applications-table {
            width: 100%;
            border-collapse: collapse;
        }

        .applications-table th {
            background: #f8f9fa;
            padding: 15px 12px;
            text-align: left;
            font-weight: 600;
            color: #333;
            border-bottom: 2px solid #e0e0e0;
            white-space: nowrap;
        }

        .applications-table td {
            padding: 15px 12px;
            border-bottom: 1px solid #f0f0f0;
            vertical-align: middle;
        }

        .applications-table tr:hover {
            background: #f8f9fa;
        }

        .applicant-info-cell {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .applicant-name {
            font-weight: 600;
            color: #333;
        }

        .applicant-email {
            font-size: 13px;
            color: #666;
        }

        .position-cell {
            font-weight: 500;
            color: #007bff;
        }

        .date-cell {
            font-size: 13px;
            color: #666;
        }

        .status-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .status-pending {
            background: #fff3cd;
            color: #856404;
        }

        .status-reviewing {
            background: #cce5ff;
            color: #004085;
        }

        .status-interview {
            background: #d4edda;
            color: #155724;
        }

        .status-hired {
            background: #d1ecf1;
            color: #0c5460;
        }

        .status-rejected {
            background: #f8d7da;
            color: #721c24;
        }

        .experience-cell {
            max-width: 200px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            font-size: 13px;
            color: #666;
        }

        .action-buttons {
            display: flex;
            gap: 5px;
            flex-wrap: wrap;
        }

        .action-btn {
            padding: 6px 12px;
            border: none;
            border-radius: 4px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 4px;
        }

        .action-btn-primary {
            background: #007bff;
            color: white;
        }

        .action-btn-secondary {
            background: #6c757d;
            color: white;
        }

        .action-btn-success {
            background: #28a745;
            color: white;
        }

        .action-btn-danger {
            background: #dc3545;
            color: white;
        }

        .action-btn:hover {
            opacity: 0.9;
            transform: translateY(-1px);
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .empty-icon {
            font-size: 48px;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        .empty-state h3 {
            color: #333;
            margin-bottom: 10px;
        }

        .empty-state p {
            color: #666;
            margin-bottom: 20px;
        }

        /* Application Detail Modal Styles - Enhanced with Full Scrolling */
        .application-modal-content {
            max-width: 95vw;
            width: 1000px;
            max-height: 95vh;
            overflow-y: auto;
            overflow-x: hidden;
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            border: 1px solid rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            scroll-behavior: smooth;
            scrollbar-gutter: stable;
        }

        /* Custom scrollbar for the modal */
        .application-modal-content::-webkit-scrollbar {
            width: 8px;
        }

        .application-modal-content::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }

        .application-modal-content::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #0073e6, #57b846);
            border-radius: 10px;
        }

        .application-modal-content::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, #005bb5, #4a9d3a);
        }

        .application-detail-content {
            display: block;
            min-height: auto;
        }

        .applicant-info {
            background: linear-gradient(135deg, #0073e6 0%, #57b846 100%);
            color: white;
            padding: 25px;
            margin: -20px -20px 0 -20px;
            border-radius: 16px 16px 0 0;
        }

        .applicant-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .applicant-header h4 {
            margin: 0;
            color: white;
            font-size: 1.8rem;
            font-weight: 600;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .status-controls select {
            padding: 10px 15px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 25px;
            font-size: 14px;
            background: rgba(255, 255, 255, 0.9);
            color: #333;
            font-weight: 500;
            min-width: 160px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .status-controls select:hover {
            background: white;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .contact-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }

        .contact-info p {
            margin: 0;
            padding: 12px 16px;
            background: rgba(255, 255, 255, 0.15);
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .contact-info strong {
            font-weight: 600;
        }

        .application-tabs {
            display: flex;
            background: #f8f9fa;
            border-radius: 12px;
            padding: 4px;
            margin: 20px 0;
            gap: 4px;
        }

        .tab-btn {
            background: transparent;
            border: none;
            padding: 12px 24px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            color: #666;
            border-radius: 8px;
            transition: all 0.3s ease;
            flex: 1;
            text-align: center;
        }

        .tab-btn.active {
            background: white;
            color: #0073e6;
            box-shadow: 0 2px 8px rgba(0, 115, 230, 0.15);
            transform: translateY(-1px);
        }

        .tab-btn:hover:not(.active) {
            background: rgba(255, 255, 255, 0.7);
            color: #0073e6;
        }

        .tab-content {
            padding: 0 5px;
            min-height: auto;
        }

        .tab-pane {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .tab-pane.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .detail-section {
            margin-bottom: 25px;
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            border: 1px solid #f0f0f0;
        }

        .detail-section h5 {
            color: #0073e6;
            margin-bottom: 15px;
            font-size: 16px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .detail-section h5::before {
            content: "📋";
            font-size: 18px;
        }

        .detail-text {
            background: #f8f9fa;
            padding: 16px;
            border-radius: 8px;
            border-left: 4px solid #0073e6;
            line-height: 1.6;
            color: #333;
            white-space: pre-wrap;
            word-wrap: break-word;
            overflow-wrap: break-word;
        }

        .notes-section {
            margin-bottom: 20px;
        }

        .notes-section textarea {
            width: 100%;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            font-family: inherit;
            font-size: 14px;
            line-height: 1.5;
            resize: vertical;
            margin-bottom: 10px;
        }

        .notes-section textarea:focus {
            border-color: #007bff;
            outline: none;
        }

        .notes-history {
            margin-top: 15px;
        }

        .note-item {
            background: #f8f9fa;
            padding: 12px;
            border-radius: 6px;
            margin-bottom: 10px;
            border-left: 4px solid #28a745;
        }

        .note-meta {
            font-size: 12px;
            color: #666;
            margin-bottom: 8px;
        }

        .note-content {
            color: #333;
            line-height: 1.5;
        }

        .history-timeline {
            margin-top: 15px;
        }

        .timeline-item {
            display: flex;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #f0f0f0;
        }

        .timeline-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            font-size: 16px;
            flex-shrink: 0;
        }

        .timeline-icon.status-change {
            background: #cce5ff;
            color: #004085;
        }

        .timeline-icon.note-added {
            background: #d4edda;
            color: #155724;
        }

        .timeline-icon.email-sent {
            background: #fff3cd;
            color: #856404;
        }

        .timeline-content {
            flex: 1;
        }

        .timeline-title {
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
        }

        .timeline-description {
            color: #666;
            font-size: 14px;
            margin-bottom: 5px;
        }

        .timeline-time {
            font-size: 12px;
            color: #999;
        }

        .application-actions {
            display: flex;
            gap: 12px;
            padding: 20px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 0 0 16px 16px;
            margin: 0 -20px -20px -20px;
            flex-wrap: wrap;
            justify-content: center;
            border-top: 1px solid #e0e0e0;
        }

        .application-actions .btn {
            min-width: 140px;
            padding: 12px 20px;
            border-radius: 25px;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .application-actions .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
        }

        .application-actions .btn-primary {
            background: linear-gradient(135deg, #0073e6, #005bb5);
            border-color: #0073e6;
        }

        .application-actions .btn-secondary {
            background: linear-gradient(135deg, #6c757d, #5a6268);
            border-color: #6c757d;
        }

        .application-actions .btn-delete {
            background: linear-gradient(135deg, #dc3545, #c82333);
            border-color: #dc3545;
        }

        /* CV Actions Styling */
        .cv-cell {
            min-width: 120px;
            text-align: center;
        }

        /* Enhanced CV Review Area Styles */
        .cv-review-area {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 12px;
            border: 2px solid #e9ecef;
        }

        .cv-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin-bottom: 20px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            border-left: 4px solid #0073e6;
        }

        .cv-info p {
            margin: 0;
            font-size: 14px;
            color: #555;
        }

        .cv-info strong {
            color: #333;
            font-weight: 600;
        }

        .cv-actions-detailed {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .cv-action-btn {
            flex: 1;
            min-width: 140px;
            padding: 12px 16px;
            border-radius: 8px;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .cv-action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .cv-preview {
            margin-top: 15px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            border: 1px solid #ddd;
        }

        .cv-preview iframe {
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .cv-actions {
            display: flex;
            flex-direction: column;
            gap: 4px;
            margin-bottom: 4px;
        }

        .cv-btn {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 4px 8px;
            font-size: 11px;
            cursor: pointer;
            transition: all 0.2s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 4px;
        }

        .cv-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .cv-view {
            background: #e3f2fd;
            border-color: #2196f3;
            color: #1976d2;
        }

        .cv-view:hover {
            background: #bbdefb;
        }

        .cv-download {
            background: #e8f5e8;
            border-color: #4caf50;
            color: #2e7d32;
        }

        .cv-download:hover {
            background: #c8e6c9;
        }

        .cv-info {
            display: block;
            font-size: 10px;
            color: #6c757d;
            margin-top: 2px;
            word-break: break-word;
            max-width: 120px;
        }

        .no-cv {
            color: #6c757d;
            font-style: italic;
            font-size: 12px;
        }

        /* Applications table improvements */
        .applications-table {
            min-width: 1000px;
        }

        .applications-table-container {
            overflow-x: auto;
            max-height: 600px;
            overflow-y: auto;
            border: 1px solid #dee2e6;
            border-radius: 8px;
        }

        .applications-table thead {
            position: sticky;
            top: 0;
            background: #f8f9fa;
            z-index: 10;
        }

        .applications-table th {
            padding: 12px 8px;
            font-size: 13px;
            font-weight: 600;
            border-bottom: 2px solid #dee2e6;
        }

        .applications-table td {
            padding: 10px 8px;
            font-size: 12px;
            border-bottom: 1px solid #f1f3f4;
            vertical-align: top;
        }

        .application-row:hover {
            background-color: #f8f9fa;
        }

        /* Responsive Design for Application Processing */
        @media (max-width: 768px) {
            .application-tools {
                flex-direction: column;
                align-items: stretch;
            }

            .tools-left,
            .tools-right {
                justify-content: center;
            }

            .search-box {
                min-width: 100%;
            }

            .applications-table-container {
                overflow-x: auto;
            }

            .applications-table {
                min-width: 800px;
            }

            .application-actions {
                flex-direction: column;
            }

            .contact-info {
                grid-template-columns: 1fr;
            }

            /* Enhanced Application Modal Mobile Styles */
            .application-modal-content {
                width: 95vw;
                max-width: 95vw;
                max-height: 95vh;
                margin: 2.5vh auto;
                overflow-y: auto;
                overflow-x: hidden;
            }

            /* Mobile scrollbar styling */
            .application-modal-content::-webkit-scrollbar {
                width: 6px;
            }

            .application-modal-content::-webkit-scrollbar-thumb {
                background: linear-gradient(135deg, #0073e6, #57b846);
                border-radius: 6px;
            }

            .applicant-info {
                margin: -15px -15px 0 -15px;
                padding: 20px 15px;
            }

            .applicant-header {
                flex-direction: column;
                align-items: stretch;
                gap: 15px;
                text-align: center;
            }

            .applicant-header h4 {
                font-size: 1.5rem;
            }

            .contact-info {
                grid-template-columns: 1fr;
                gap: 10px;
            }

            .contact-info p {
                padding: 10px 12px;
                font-size: 13px;
            }

            .application-tabs {
                margin: 15px 0;
                padding: 3px;
            }

            .tab-btn {
                padding: 10px 16px;
                font-size: 13px;
            }

            .detail-section {
                padding: 15px;
                margin-bottom: 15px;
            }

            .detail-section h5 {
                font-size: 15px;
            }

            .detail-text {
                padding: 12px;
                font-size: 14px;
                /* Remove height constraint for mobile scrolling */
            }

            .application-actions {
                flex-direction: column;
                gap: 8px;
                padding: 15px;
            }

            .application-actions .btn {
                min-width: auto;
                width: 100%;
                padding: 12px 16px;
                font-size: 14px;
            }

            /* Mobile CV Review Styles */
            .cv-review-area {
                padding: 15px;
            }

            .cv-info {
                grid-template-columns: 1fr;
                gap: 8px;
                padding: 12px;
            }

            .cv-actions-detailed {
                flex-direction: column;
                gap: 8px;
            }

            .cv-action-btn {
                min-width: auto;
                width: 100%;
            }

            .cv-preview iframe {
                height: 300px;
            }
        }

        /* Admin Management Styles */
        .admin-table-container {
            overflow-x: auto;
            max-height: 600px;
            overflow-y: auto;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            background: white;
        }

        .admin-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
        }

        .admin-table th {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            color: #495057;
            font-weight: 600;
            padding: 12px;
            text-align: left;
            border-bottom: 2px solid #dee2e6;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .admin-table td {
            padding: 12px;
            border-bottom: 1px solid #dee2e6;
            vertical-align: middle;
        }

        .admin-table tr:hover {
            background-color: #f8f9fa;
        }

        .admin-info-cell {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .admin-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: linear-gradient(135deg, #0073e6, #57b846);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 14px;
        }

        .admin-details {
            flex: 1;
        }

        .admin-name {
            font-weight: 600;
            color: #333;
            margin-bottom: 2px;
        }

        .admin-email {
            font-size: 12px;
            color: #666;
        }

        .role-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .role-admin {
            background: #e3f2fd;
            color: #1976d2;
        }

        .role-super-admin {
            background: #f3e5f5;
            color: #7b1fa2;
        }

        .admin-status {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .status-active {
            background: #e8f5e8;
            color: #2e7d32;
        }

        .status-inactive {
            background: #ffebee;
            color: #c62828;
        }

        .admin-actions {
            display: flex;
            gap: 4px;
        }

        .admin-action-btn {
            padding: 6px 8px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s ease;
        }

        .admin-action-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .admin-edit {
            background: #fff3cd;
            color: #856404;
        }

        .admin-delete {
            background: #f8d7da;
            color: #721c24;
        }

        .admin-reset-password {
            background: #d4edda;
            color: #155724;
        }

        .search-input {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 20px;
            font-size: 14px;
            width: 250px;
            transition: all 0.3s ease;
        }

        .search-input:focus {
            outline: none;
            border-color: #0073e6;
            box-shadow: 0 0 0 3px rgba(0, 115, 230, 0.1);
        }

        .form-actions {
            display: flex;
            gap: 12px;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #eee;
        }

        .form-actions .btn {
            flex: 1;
        }

        /* Mobile Admin Management Styles */
        @media (max-width: 768px) {
            .admin-table-container {
                overflow-x: auto;
            }

            .admin-table th,
            .admin-table td {
                padding: 8px;
                font-size: 12px;
            }

            .admin-info-cell {
                flex-direction: column;
                align-items: flex-start;
                gap: 4px;
            }

            .admin-avatar {
                width: 24px;
                height: 24px;
                font-size: 12px;
            }

            .search-input {
                width: 100%;
                margin-bottom: 10px;
            }

            .form-actions {
                flex-direction: column;
            }

            .form-actions .btn {
                width: 100%;
            }
        }

        /* Documents Management Styles */
        .documents-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 20px;
        }

        .documents-stats {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }

        .documents-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .document-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            border: 1px solid #e0e0e0;
            position: relative;
        }

        .document-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
        }

        .document-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }

        .document-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: #333;
            margin: 0;
            flex: 1;
        }

        .document-status {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
            margin-left: 10px;
        }

        .document-status.visible {
            background: #d4edda;
            color: #155724;
        }

        .document-status.hidden {
            background: #f8d7da;
            color: #721c24;
        }

        .document-info {
            margin-bottom: 15px;
        }

        .document-info p {
            margin: 5px 0;
            color: #666;
            font-size: 0.9rem;
        }

        .document-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .document-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 500;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .document-btn.primary {
            background: #007bff;
            color: white;
        }

        .document-btn.primary:hover {
            background: #0056b3;
        }

        .document-btn.secondary {
            background: #6c757d;
            color: white;
        }

        .document-btn.secondary:hover {
            background: #545b62;
        }

        .document-btn.danger {
            background: #dc3545;
            color: white;
        }

        .document-btn.danger:hover {
            background: #c82333;
        }

        .document-btn.success {
            background: #28a745;
            color: white;
        }

        .document-btn.success:hover {
            background: #1e7e34;
        }

        .document-upload-area {
            border: 2px dashed #ddd;
            border-radius: 10px;
            padding: 40px;
            text-align: center;
            background: #f8f9fa;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .document-upload-area:hover {
            border-color: #007bff;
            background: #f0f8ff;
        }

        .document-upload-area.dragover {
            border-color: #007bff;
            background: #e3f2fd;
        }

        .upload-icon {
            font-size: 3rem;
            color: #007bff;
            margin-bottom: 15px;
        }

        .upload-text {
            font-size: 1.1rem;
            color: #666;
            margin-bottom: 10px;
        }

        .upload-hint {
            font-size: 0.9rem;
            color: #999;
        }

        .file-input {
            display: none;
        }

        .document-preview {
            max-width: 100%;
            max-height: 200px;
            border-radius: 8px;
            margin: 10px 0;
        }

        @media (max-width: 768px) {
            .documents-controls {
                flex-direction: column;
                align-items: stretch;
            }

            .documents-stats {
                justify-content: center;
            }

            .documents-grid {
                grid-template-columns: 1fr;
            }

            .document-actions {
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <!-- Login Form -->
    <div id="login-form" class="login-form">
        <div class="login-container">
            <img src="images/mylogo.png" alt="Prince Alex Logo" class="login-logo">
            <h2 class="login-title">COMBEST Admin</h2>
            <p class="login-subtitle">Please login to access the admin panel</p>
            <form id="login-form-element">
                <input type="email" id="login-email" class="login-input" placeholder="Email Address" required>
                <input type="password" id="login-password" class="login-input" placeholder="Password" required>
                <button type="submit" id="login-submit-btn" class="login-btn">Login</button>
                <div id="login-error" class="login-error"></div>
            </form>
        </div>
    </div>

    <div class="admin-container" id="admin-content">
        <!-- Mobile Sidebar Overlay -->
        <div class="sidebar-overlay" id="sidebar-overlay" onclick="closeSidebar()"></div>
        
        <!-- Sidebar -->
        <nav class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h2>COMBEST Admin</h2>
            </div>
            <ul class="sidebar-menu">
                <li><a href="#" onclick="switchTab('dashboard')" class="active" id="dashboard-tab">
                    <i>📊</i><span>Dashboard</span>
                </a></li>
                <li><a href="#" onclick="switchTab('testimonials')" id="testimonials-tab">
                    <i>💬</i><span>Testimonials</span>
                </a></li>
                <li><a href="#" onclick="switchTab('founders')" id="founders-tab">
                    <i>👥</i><span>Team Members</span>
                </a></li>
                <li><a href="#" onclick="switchTab('jobs')" id="jobs-tab">
                    <i>💼</i><span>Careers</span>
                </a></li>
                <li><a href="#" onclick="switchTab('gallery')" id="gallery-tab">
                    <i>🖼️</i><span>Gallery</span>
                </a></li>
                <li><a href="#" onclick="switchTab('messages')" id="messages-tab">
                    <i>📧</i><span>Messages</span>
                </a></li>
                <li><a href="#" onclick="switchTab('applications')" id="applications-tab">
                    <i>📋</i><span>Applications</span>
                </a></li>
                <li><a href="#" onclick="switchTab('documents')" id="documents-tab">
                    <i>📄</i><span>Documents</span>
                </a></li>
                <li><a href="#" onclick="switchTab('activity-logs')" id="activity-logs-tab">
                    <i>📊</i><span>Activity Logs</span>
                </a></li>
                <li><a href="#" onclick="switchTab('email-settings')" id="email-settings-tab">
                    <i>📧</i><span>Email Settings</span>
                </a></li>
                <li><a href="#" onclick="switchTab('admin-management')" id="admin-management-tab">
                    <i>👥</i><span>Admin Management</span>
                </a></li>
            </ul>
        </nav>

        <!-- Main Content -->
        <main class="main-content" id="main-content">
            <!-- Header -->
            <header class="header">
                <div>
                    <h1>Admin Panel</h1>
                    <span class="welcome-text" id="welcome-text">Welcome, Admin!</span>
                </div>
                <button class="mobile-menu-btn" id="mobileMenuBtn" onclick="toggleSidebar()">
                    <div class="hamburger" id="hamburger">
                        <span></span>
                        <span></span>
                        <span></span>
                    </div>
                </button>
                <button class="logout-btn" onclick="logout()">Logout</button>
            </header>

            <!-- Dashboard Section -->
            <section id="dashboard-section" class="content-section">
                <h2 class="section-title">Dashboard Overview</h2>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number" id="testimonials-count">0</div>
                        <div class="stat-label">Testimonials</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="founders-count">0</div>
                        <div class="stat-label">Team Members</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="jobs-count">0</div>
                        <div class="stat-label">Job Postings</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="gallery-count">0</div>
                        <div class="stat-label">Gallery Items</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="messages-count">0</div>
                        <div class="stat-label">Messages</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="applications-count">0</div>
                        <div class="stat-label">Applications</div>
                    </div>
                </div>
            </section>

            <!-- Testimonials Section -->
            <section id="testimonials-section" class="content-section" style="display: none;">
                <h2 class="section-title">Testimonials Management</h2>
                <button class="add-btn" onclick="openAddModal('testimonials')">Add New Testimonial</button>
                <div class="data-grid" id="testimonials-grid"></div>
            </section>

            <!-- Team Members Section -->
            <section id="founders-section" class="content-section" style="display: none;">
                <h2 class="section-title">Team Members Management</h2>
                <button class="add-btn" onclick="openAddModal('founders')">Add New Team Member</button>
                <div class="data-grid" id="founders-grid"></div>
            </section>

            <!-- Careers Section -->
            <section id="jobs-section" class="content-section" style="display: none;">
                <h2 class="section-title">Job Postings Management</h2>
                <button class="add-btn" onclick="openAddModal('jobs')">Add New Job</button>
                <div class="data-grid" id="jobs-grid"></div>
            </section>

            <!-- Gallery Section -->
            <section id="gallery-section" class="content-section" style="display: none;">
                <h2 class="section-title">Gallery Management</h2>
                <button class="add-btn" onclick="openAddModal('gallery')">Add New Gallery Item</button>
                <div class="data-grid" id="gallery-grid"></div>
            </section>

            <!-- Messages Section -->
            <section id="messages-section" class="content-section" style="display: none;">
                <h2 class="section-title">Contact Messages</h2>
                <div class="data-grid" id="messages-grid"></div>
            </section>

            <!-- Applications Section -->
            <section id="applications-section" class="content-section" style="display: none;">
                <div class="applications-header">
                    <h2 class="section-title">🎯 Application Processing Center</h2>
                    <div class="applications-stats">
                        <div class="stat-card">
                            <div class="stat-icon">📝</div>
                            <div class="stat-content">
                                <div class="stat-number" id="total-applications">0</div>
                                <div class="stat-label">Total Applications</div>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">⏳</div>
                            <div class="stat-content">
                                <div class="stat-number" id="pending-applications">0</div>
                                <div class="stat-label">Pending Review</div>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">👁️</div>
                            <div class="stat-content">
                                <div class="stat-number" id="reviewing-applications">0</div>
                                <div class="stat-label">Under Review</div>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">🎤</div>
                            <div class="stat-content">
                                <div class="stat-number" id="interview-applications">0</div>
                                <div class="stat-label">Interview Stage</div>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">✅</div>
                            <div class="stat-content">
                                <div class="stat-number" id="hired-applications">0</div>
                                <div class="stat-label">Hired</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Application Management Tools -->
                <div class="application-tools">
                    <div class="tools-left">
                        <div class="search-box">
                            <input type="text" id="application-search" placeholder="Search applications..." onkeyup="searchApplications()">
                            <span class="search-icon">🔍</span>
                        </div>
                        <div class="filter-group">
                            <select id="status-filter" class="filter-select" onchange="filterApplications()">
                                <option value="all">All Status</option>
                                <option value="pending">Pending</option>
                                <option value="reviewing">Under Review</option>
                                <option value="interview">Interview</option>
                                <option value="hired">Hired</option>
                                <option value="rejected">Rejected</option>
                            </select>
                            <select id="position-filter" class="filter-select" onchange="filterApplications()">
                                <option value="all">All Positions</option>
                            </select>
                            <select id="date-filter" class="filter-select" onchange="filterApplications()">
                                <option value="all">All Dates</option>
                                <option value="today">Today</option>
                                <option value="week">This Week</option>
                                <option value="month">This Month</option>
                            </select>
                        </div>
                    </div>
                    <div class="tools-right">
                        <div class="bulk-actions" id="bulk-actions" style="display: none;">
                            <select id="bulk-action-select">
                                <option value="">Bulk Actions</option>
                                <option value="review">Move to Review</option>
                                <option value="interview">Schedule Interview</option>
                                <option value="reject">Reject Selected</option>
                                <option value="export">Export Selected</option>
                            </select>
                            <button class="btn btn-secondary" onclick="executeBulkAction()">Apply</button>
                        </div>
                        <button class="btn btn-primary" onclick="exportApplications()">
                            <span class="btn-icon">📊</span>
                            Export All
                        </button>
                        <button class="btn btn-secondary" onclick="refreshApplications()">
                            <span class="btn-icon">🔄</span>
                            Refresh
                        </button>
                    </div>
                </div>

                <!-- Applications Table -->
                <div class="applications-table-container">
                    <table class="applications-table" id="applications-table">
                        <thead>
                            <tr>
                                <th>
                                    <input type="checkbox" id="select-all-applications" onchange="toggleSelectAll()">
                                </th>
                                <th>Applicant</th>
                                <th>Position</th>
                                <th>Applied Date</th>
                                <th>Status</th>
                                <th>CV/Resume</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="applications-table-body">
                            <!-- Applications will be populated here -->
                        </tbody>
                    </table>
                </div>

                <!-- Empty State -->
                <div id="applications-empty-state" class="empty-state" style="display: none;">
                    <div class="empty-icon">📝</div>
                    <h3>No Applications Found</h3>
                    <p>No job applications match your current filters.</p>
                    <button class="btn btn-secondary" onclick="clearApplicationFilters()">Clear Filters</button>
                </div>
            </section>

            <!-- Documents Management Section -->
            <section id="documents-section" class="content-section" style="display: none;">
                <div class="applications-header">
                    <h2 class="section-title">📄 Company Documents Management</h2>
                    <p class="section-subtitle">Manage downloadable company documents for the About page</p>
                </div>
                
                <div class="documents-controls">
                    <button class="add-btn" onclick="openDocumentModal()">
                        <i>📤</i> Upload New Document
                    </button>
                    <div class="documents-stats">
                        <div class="stat-card">
                            <span class="stat-number" id="total-documents">0</span>
                            <span class="stat-label">Total Documents</span>
                        </div>
                        <div class="stat-card">
                            <span class="stat-number" id="visible-documents">0</span>
                            <span class="stat-label">Visible on About Page</span>
                        </div>
                    </div>
                </div>

                <div class="documents-grid" id="documents-grid">
                    <!-- Documents will be loaded here -->
                </div>
            </section>

            <!-- Activity Logs Section -->
            <section id="activity-logs-section" class="content-section" style="display: none;">
                <div class="applications-header">
                    <h2 class="section-title">Activity Logs & Email Notifications</h2>
                    <div class="applications-stats">
                        <div class="stat-card">
                            <div class="stat-icon">📧</div>
                            <div class="stat-content">
                                <div class="stat-number" id="total-logs">0</div>
                                <div class="stat-label">Total Activities</div>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">✅</div>
                            <div class="stat-content">
                                <div class="stat-number" id="emails-sent">0</div>
                                <div class="stat-label">Emails Sent</div>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">⚡</div>
                            <div class="stat-content">
                                <div class="stat-number" id="recent-activities">0</div>
                                <div class="stat-label">Today's Activities</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Activity Filters -->
                <div class="subsection">
                    <div class="subsection-header">
                        <h3 class="subsection-title">📊 Activity History</h3>
                        <div class="subsection-actions">
                            <button class="btn btn-primary" onclick="downloadActivityCSV()">
                                <span class="btn-icon">📥</span>
                                Download CSV
                            </button>
                            <button class="btn btn-edit" onclick="refreshActivityLogs()">
                                <span class="btn-icon">🔄</span>
                                Refresh
                            </button>
                        </div>
                    </div>
                    <div class="subsection-filters" style="margin-bottom: 20px;">
                        <select id="activity-filter" class="filter-select" onchange="filterActivityLogs()">
                            <option value="all">All Activities</option>
                            <option value="login">Login/Logout</option>
                            <option value="create">Create Operations</option>
                            <option value="update">Update Operations</option>
                            <option value="delete">Delete Operations</option>
                            <option value="status">Status Changes</option>
                        </select>
                        <select id="date-filter" class="filter-select" onchange="filterActivityLogs()">
                            <option value="all">All Time</option>
                            <option value="today">Today</option>
                            <option value="week">This Week</option>
                            <option value="month">This Month</option>
                        </select>
                </div>
                    <div class="activity-table-container">
                        <table id="activity-table" class="activity-table">
                            <thead>
                                <tr>
                                    <th>Time</th>
                                    <th>Action</th>
                                    <th>Type</th>
                                    <th>Item</th>
                                    <th>Admin</th>
                                    <th>Details</th>
                                </tr>
                            </thead>
                            <tbody id="activity-table-body">
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Email Settings Section -->
            <section id="email-settings-section" class="content-section" style="display: none;">
                <div class="applications-header">
                    <h2 class="section-title">📧 Email Notification Settings</h2>
                    <div class="applications-stats">
                        <div class="stat-card">
                            <div class="stat-icon">📧</div>
                            <div class="stat-content">
                                <div class="stat-number" id="emails-sent-settings">0</div>
                                <div class="stat-label">Emails Sent</div>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">⚙️</div>
                            <div class="stat-content">
                                <div class="stat-number" id="email-config-status">❌</div>
                                <div class="stat-label">Configuration</div>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">🧪</div>
                            <div class="stat-content">
                                <div class="stat-number" id="last-test-status">-</div>
                                <div class="stat-label">Last Test</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Email Configuration -->
                <div class="subsection">
                    <div class="subsection-header">
                        <h3 class="subsection-title">📧 Email Configuration</h3>
                        <div class="subsection-actions">
                            <button class="btn btn-primary" onclick="testEmailService()">
                                <span class="btn-icon">🧪</span>
                                Test Email Service
                            </button>
                            <button class="btn btn-edit" onclick="openEmailConfigModal()">
                                <span class="btn-icon">⚙️</span>
                                Configure Email
                            </button>
                        </div>
                    </div>
                    <div class="data-card">
                        <div class="card-header">
                            <div class="card-title">Email Notification Settings</div>
                        </div>
                        <p><strong>Status:</strong> <span id="email-status" class="status-badge status-pending">Not Configured</span></p>
                        <p><strong>Notification Email:</strong> <span id="notification-email">Not set</span></p>
                        <p><strong>Service:</strong> EmailJS</p>
                        <p><strong>Activities Tracked:</strong> Login/Logout, CRUD Operations, Status Changes</p>
                    </div>
                </div>
            </section>

            <!-- Admin Management Section -->
            <section id="admin-management-section" class="content-section" style="display: none;">
                <div class="applications-header">
                    <h2 class="section-title">👥 Admin Management</h2>
                    <div class="applications-stats">
                        <div class="stat-card">
                            <div class="stat-icon">👥</div>
                            <div class="stat-content">
                                <div class="stat-number" id="total-admins">0</div>
                                <div class="stat-label">Total Admins</div>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">✅</div>
                            <div class="stat-content">
                                <div class="stat-number" id="active-admins">0</div>
                                <div class="stat-label">Active Admins</div>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">🆕</div>
                            <div class="stat-content">
                                <div class="stat-number" id="recent-admins">0</div>
                                <div class="stat-label">Added This Month</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Add New Admin -->
                <div class="subsection">
                    <div class="subsection-header">
                        <h3 class="subsection-title">➕ Add New Administrator</h3>
                        <div class="subsection-actions">
                            <button class="btn btn-primary" onclick="openAddAdminModal()">
                                <span class="btn-icon">👤</span>
                                Add Admin User
                            </button>
                            <button class="btn btn-secondary" onclick="refreshAdminList()">
                                <span class="btn-icon">🔄</span>
                                Refresh List
                            </button>
                        </div>
                    </div>
                    
                    <!-- Add Admin Form -->
                    <div class="data-card" id="add-admin-form-card" style="display: none;">
                        <div class="card-header">
                            <div class="card-title">Create New Administrator</div>
                            <button class="close-btn" onclick="hideAddAdminForm()">&times;</button>
                        </div>
                        <form id="add-admin-form">
                            <div class="form-group">
                                <label for="admin-name">Full Name</label>
                                <input type="text" id="admin-name" name="name" placeholder="Enter administrator's full name" required>
                                <small>This will be displayed in the admin interface</small>
                            </div>
                            <div class="form-group">
                                <label for="admin-email">Email Address</label>
                                <input type="email" id="admin-email" name="email" placeholder="admin@example.com" required>
                                <small>This will be used for login authentication</small>
                            </div>
                            <div class="form-group">
                                <label for="admin-password">Password</label>
                                <input type="password" id="admin-password" name="password" placeholder="Enter secure password" required minlength="6">
                                <small>Minimum 6 characters required</small>
                            </div>
                            <div class="form-group">
                                <label for="admin-role">Role</label>
                                <select id="admin-role" name="role" required>
                                    <option value="admin">Administrator</option>
                                    <option value="super-admin">Super Administrator</option>
                                </select>
                                <small>Super admins can manage other administrators</small>
                            </div>
                            <div class="form-actions">
                                <button type="submit" class="btn btn-primary">
                                    <span class="btn-icon">✅</span>
                                    Create Administrator
                                </button>
                                <button type="button" class="btn btn-secondary" onclick="hideAddAdminForm()">
                                    <span class="btn-icon">❌</span>
                                    Cancel
                                </button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Admin List -->
                <div class="subsection">
                    <div class="subsection-header">
                        <h3 class="subsection-title">📋 Current Admin Information</h3>
                        <div class="subsection-actions">
                            <small style="color: #666;">Firebase Auth only - showing current logged-in admin</small>
                        </div>
                    </div>
                    
                    <div class="admin-table-container">
                        <table class="admin-table">
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Email</th>
                                    <th>Role</th>
                                    <th>Created</th>
                                    <th>Last Login</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="admin-table-body">
                                <!-- Admin rows will be populated here -->
                            </tbody>
                        </table>
                    </div>

                    <div class="empty-state" id="admin-empty-state" style="display: none;">
                        <div class="empty-icon">👥</div>
                        <h3>Admin Information</h3>
                        <p>You are currently logged in as an administrator. Create additional admin accounts using the form above.</p>
                        <button class="btn btn-primary" onclick="openAddAdminModal()">Add New Admin</button>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Modal -->
    <div id="modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="modal-title">Add New Item</h3>
                <button class="close-btn" onclick="closeModal()">&times;</button>
            </div>
            <form id="modal-form">
                <div id="form-fields"></div>
                <button type="submit" class="submit-btn" id="submit-btn">Save</button>
            </form>
        </div>
    </div>

    <!-- Email Configuration Modal -->
    <div id="email-config-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Email Configuration</h3>
                <button class="close-btn" onclick="closeEmailConfigModal()">&times;</button>
            </div>
            <form id="email-config-form">
                <div class="form-group">
                    <label>EmailJS Service ID</label>
                    <input type="text" name="serviceId" id="email-service-id" placeholder="your_service_id" required>
                    <small>Get this from your EmailJS dashboard</small>
                </div>
                <div class="form-group">
                    <label>EmailJS Template ID</label>
                    <input type="text" name="templateId" id="email-template-id" placeholder="your_template_id" required>
                    <small>Create a template in EmailJS for admin notifications</small>
                </div>
                <div class="form-group">
                    <label>EmailJS Public Key</label>
                    <input type="text" name="publicKey" id="email-public-key" placeholder="your_public_key" required>
                    <small>Your EmailJS public key</small>
                </div>
                <div class="form-group">
                    <label>Notification Email Address</label>
                    <input type="email" name="notificationEmail" id="notification-email-input" placeholder="admin@combest.com" required>
                    <small>Where to send activity notifications</small>
                </div>
                <div class="form-group">
                    <label>Admin Name</label>
                    <input type="text" name="adminName" id="admin-name-input" placeholder="Admin Name" required>
                    <small>Name to use in email notifications</small>
                </div>
                <button type="submit" class="submit-btn">Save Configuration</button>
            </form>
        </div>
    </div>

    <!-- Application Detail Modal -->
    <div id="application-detail-modal" class="modal">
        <div class="modal-content application-modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Application Details</h3>
                <button class="close-btn" onclick="closeApplicationDetailModal()">&times;</button>
            </div>
            <div class="application-detail-content">
                <div class="applicant-info">
                    <div class="applicant-header">
                        <h4 id="applicant-name">John Doe</h4>
                        <div class="status-controls">
                            <select id="application-status-select" onchange="updateApplicationStatus()">
                                <option value="pending">Pending Review</option>
                                <option value="reviewing">Under Review</option>
                                <option value="interview">Interview Stage</option>
                                <option value="hired">Hired</option>
                                <option value="rejected">Rejected</option>
                            </select>
                        </div>
                    </div>
                    <div class="contact-info">
                        <p><strong>📧 Email:</strong> <span id="applicant-email">john@example.com</span></p>
                        <p><strong>📞 Phone:</strong> <span id="applicant-phone">+1234567890</span></p>
                        <p><strong>💼 Position:</strong> <span id="applicant-position">Software Developer</span></p>
                        <p><strong>📅 Applied:</strong> <span id="applicant-date">Jan 15, 2024</span></p>
                    </div>
                </div>
                
                <div class="application-tabs">
                    <button class="tab-btn active" onclick="switchApplicationTab('details')">Details</button>
                    <button class="tab-btn" onclick="switchApplicationTab('notes')">Notes</button>
                    <button class="tab-btn" onclick="switchApplicationTab('history')">History</button>
                </div>
                
                <div class="tab-content">
                    <div id="details-tab" class="tab-pane active">
                        <div class="detail-section">
                            <h5>Experience</h5>
                            <div id="applicant-experience" class="detail-text">Experience details will appear here...</div>
                        </div>
                        <div class="detail-section">
                            <h5>Cover Letter</h5>
                            <div id="applicant-cover-letter" class="detail-text">Cover letter will appear here...</div>
                        </div>
                        <div class="detail-section" id="resume-section" style="display: none;">
                            <h5>📋 CV/Resume Review</h5>
                            <div class="cv-review-area">
                                <div class="cv-info">
                                    <p><strong>File:</strong> <span id="cv-filename">Resume.pdf</span></p>
                                    <p><strong>Size:</strong> <span id="cv-filesize">--</span></p>
                                    <p><strong>Uploaded:</strong> <span id="cv-upload-date">--</span></p>
                                </div>
                                <div class="cv-actions-detailed">
                                    <button id="resume-view-btn" class="btn btn-primary cv-action-btn" onclick="viewCVInModal()">
                                        👁️ View CV
                                    </button>
                                    <button id="resume-download-btn" class="btn btn-secondary cv-action-btn" onclick="downloadCVFromModal()">
                                        📥 Download
                                    </button>
                                    <button id="resume-open-btn" class="btn btn-success cv-action-btn">
                                        🔗 Open in New Tab
                                    </button>
                                </div>
                                <div class="cv-preview" id="cv-preview-container" style="display: none;">
                                    <iframe id="cv-preview-frame" src="" width="100%" height="400" style="border: 1px solid #ddd; border-radius: 8px;"></iframe>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div id="notes-tab" class="tab-pane">
                        <div class="notes-section">
                            <textarea id="application-notes" placeholder="Add your notes about this application..." rows="6"></textarea>
                            <button class="btn btn-primary" onclick="saveApplicationNotes()">Save Notes</button>
                        </div>
                        <div class="notes-history" id="notes-history">
                            <!-- Previous notes will appear here -->
                        </div>
                    </div>
                    
                    <div id="history-tab" class="tab-pane">
                        <div class="history-timeline" id="application-history">
                            <!-- Application history will appear here -->
                        </div>
                    </div>
                </div>
                
                <div class="application-actions">
                    <button class="btn btn-primary" onclick="scheduleInterview()">
                        <span class="btn-icon">🎤</span>
                        Schedule Interview
                    </button>
                    <button class="btn btn-secondary" onclick="sendApplicationEmail()">
                        <span class="btn-icon">📧</span>
                        Send Email
                    </button>
                    <button class="btn btn-secondary" onclick="exportApplicationPDF()">
                        <span class="btn-icon">📄</span>
                        Export PDF
                    </button>
                    <button class="btn btn-delete" onclick="rejectApplication()">
                        <span class="btn-icon">❌</span>
                        Reject
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Interview Scheduling Modal -->
    <div id="interview-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Schedule Interview</h3>
                <button class="close-btn" onclick="closeInterviewModal()">&times;</button>
            </div>
            <form id="interview-form">
                <div class="form-group">
                    <label>Interview Type</label>
                    <select name="interviewType" required>
                        <option value="">Select Type</option>
                        <option value="phone">Phone Interview</option>
                        <option value="video">Video Interview</option>
                        <option value="in-person">In-Person Interview</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Date</label>
                    <input type="date" name="interviewDate" required>
                </div>
                <div class="form-group">
                    <label>Time</label>
                    <input type="time" name="interviewTime" required>
                </div>
                <div class="form-group">
                    <label>Duration (minutes)</label>
                    <select name="duration">
                        <option value="30">30 minutes</option>
                        <option value="45">45 minutes</option>
                        <option value="60" selected>1 hour</option>
                        <option value="90">1.5 hours</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Interviewer(s)</label>
                    <input type="text" name="interviewer" placeholder="Enter interviewer names" required>
                </div>
                <div class="form-group">
                    <label>Meeting Link/Location</label>
                    <input type="text" name="location" placeholder="Zoom link, office address, etc.">
                </div>
                <div class="form-group">
                    <label>Additional Notes</label>
                    <textarea name="notes" rows="3" placeholder="Any special instructions or notes..."></textarea>
                </div>
                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">Schedule Interview</button>
                    <button type="button" class="btn btn-secondary" onclick="closeInterviewModal()">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Email Template Modal -->
    <div id="email-template-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Send Email to Applicant</h3>
                <button class="close-btn" onclick="closeEmailTemplateModal()">&times;</button>
            </div>
            <form id="email-template-form">
                <div class="form-group">
                    <label>Email Template</label>
                    <select id="email-template-select" onchange="loadEmailTemplate()">
                        <option value="">Select Template</option>
                        <option value="interview-invitation">Interview Invitation</option>
                        <option value="application-received">Application Received</option>
                        <option value="application-rejected">Application Rejected</option>
                        <option value="offer-letter">Job Offer</option>
                        <option value="custom">Custom Email</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Subject</label>
                    <input type="text" id="email-subject" name="subject" required>
                </div>
                <div class="form-group">
                    <label>Message</label>
                    <textarea id="email-message" name="message" rows="8" required></textarea>
                </div>
                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">Send Email</button>
                    <button type="button" class="btn btn-secondary" onclick="closeEmailTemplateModal()">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Document Upload Modal -->
    <div id="document-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Upload Company Document</h3>
                <button class="close-btn" onclick="closeDocumentModal()">&times;</button>
            </div>
            <form id="document-form">
                <div class="form-group">
                    <label>Document Title *</label>
                    <input type="text" id="document-title" name="title" required placeholder="e.g., Company Profile, Service Brochure">
                </div>
                <div class="form-group">
                    <label>Description</label>
                    <textarea id="document-description" name="description" rows="3" placeholder="Brief description of the document"></textarea>
                </div>
                <div class="form-group">
                    <label>Document File *</label>
                    <div class="document-upload-area" onclick="document.getElementById('document-file').click()">
                        <div class="upload-icon">📄</div>
                        <div class="upload-text">Click to select PDF file</div>
                        <div class="upload-hint">Maximum size: 10MB</div>
                        <input type="file" id="document-file" name="file" accept=".pdf" class="file-input" required>
                    </div>
                    <div id="file-preview" style="display: none; margin-top: 10px;">
                        <div class="document-preview" id="file-preview-content"></div>
                        <p id="file-info" style="margin: 5px 0; color: #666;"></p>
                    </div>
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="document-visible" name="visible" checked>
                        Show on About page
                    </label>
                </div>
                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">Upload Document</button>
                    <button type="button" class="btn btn-secondary" onclick="closeDocumentModal()">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Success/Error Messages -->
    <div id="success-message" class="success-message"></div>
    <div id="error-message" class="error-message"></div>

    <!-- Auto-logout Warning -->
    <div id="auto-logout-warning" class="auto-logout-warning">
        <h3>⏰ Session Expiring Soon</h3>
        <p>You will be automatically logged out in:</p>
        <div class="countdown" id="logout-countdown">30</div>
        <p style="margin-top: 15px;">
            <button class="btn btn-primary" onclick="extendSession()" style="margin-right: 10px;">Stay Logged In</button>
            <button class="btn btn-delete" onclick="logoutNow()">Logout Now</button>
        </p>
    </div>

    <!-- EmailJS SDK -->
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>

    <!-- Firebase Configuration -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, updateDoc, deleteDoc, doc, onSnapshot, query, orderBy, serverTimestamp, getDocs } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyC0TdBjLeGimGoYZwLxzC4fQLPBdSzrT0A",
            authDomain: "universityweb-19e1e.firebaseapp.com",
            projectId: "universityweb-19e1e",
            storageBucket: "universityweb-19e1e.firebasestorage.app",
            messagingSenderId: "401942926589",
            appId: "1:401942926589:web:c98e8d71ae6bd396775a94"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // Global variables
        let currentUser = null;
        let currentItemId = null;
        let currentItemType = null;
        let allData = {
            testimonials: [],
            founders: [],
            jobs: [],
            gallery: [],
            messages: [],
            applications: [],
            activityLogs: []
        };

        // Make allData globally accessible
        window.allData = allData;

        // Test function to manually check messages collection
        window.testMessagesCollection = async function() {
            try {
                console.log('Testing messages collection...');
                const messagesRef = collection(db, 'messages');
                const snapshot = await getDocs(messagesRef);
                console.log('Messages collection test - found', snapshot.docs.length, 'documents');
                snapshot.docs.forEach(doc => {
                    console.log('Document:', doc.id, doc.data());
                });
                return snapshot.docs.length;
            } catch (error) {
                console.error('Error testing messages collection:', error);
                return -1;
            }
        };

        window.testApplicationsCollection = async function() {
            try {
                console.log('Testing applications collection...');
                console.log('Firebase Config - Project ID:', firebaseConfig.projectId);
                console.log('Database instance:', db);
                
                const applicationsRef = collection(db, 'applications');
                const snapshot = await getDocs(applicationsRef);
                console.log('Applications collection test - found', snapshot.docs.length, 'documents');
                
                if (snapshot.docs.length === 0) {
                    console.warn('⚠️ No applications found in the collection. This could mean:');
                    console.warn('1. No applications have been submitted yet');
                    console.warn('2. Applications are being saved to a different collection');
                    console.warn('3. There might be a permissions issue');
                } else {
                    console.log('✅ Applications found! Here are the documents:');
                    let applicationsWithMissingNames = 0;
                    
                    snapshot.docs.forEach((doc, index) => {
                        const data = doc.data();
                        console.log(`Application ${index + 1}:`, doc.id);
                        console.log('  Name fields:', {
                            name: data.name,
                            firstName: data.firstName,
                            lastName: data.lastName,
                            fullName: data.fullName,
                            email: data.email
                        });
                        
                        // Check if name data is missing
                        if (!data.name && !data.firstName && !data.lastName && !data.fullName) {
                            applicationsWithMissingNames++;
                            console.warn(`  ⚠️ Application ${doc.id} has no name data!`);
                        }
                        
                        console.log('  Full data:', data);
                    });
                    
                    if (applicationsWithMissingNames > 0) {
                        console.warn(`Found ${applicationsWithMissingNames} applications with missing name data`);
                        console.log('💡 You can run fixApplicationNames() to attempt to fix this');
                    }
                }
                
                return snapshot.docs.length;
            } catch (error) {
                console.error('Error testing applications collection:', error);
                console.error('Error details:', {
                    code: error.code,
                    message: error.message
                });
                return -1;
            }
        };

        // Function to help fix applications with missing names
        window.fixApplicationNames = async function() {
            try {
                console.log('🔧 Attempting to fix applications with missing names...');
                const applicationsRef = collection(db, 'applications');
                const snapshot = await getDocs(applicationsRef);
                
                let fixedCount = 0;
                const fixPromises = [];
                
                snapshot.docs.forEach(doc => {
                    const data = doc.data();
                    const hasName = data.name && data.name.trim();
                    const hasFirstLast = data.firstName || data.lastName;
                    
                    if (!hasName && hasFirstLast) {
                        const firstName = data.firstName || '';
                        const lastName = data.lastName || '';
                        const fullName = `${firstName} ${lastName}`.trim();
                        
                        if (fullName) {
                            console.log(`Fixing ${doc.id}: Setting name to "${fullName}"`);
                            const updatePromise = updateDoc(doc.ref, { name: fullName });
                            fixPromises.push(updatePromise);
                            fixedCount++;
                        }
                    }
                });
                
                if (fixPromises.length > 0) {
                    await Promise.all(fixPromises);
                    console.log(`✅ Fixed ${fixedCount} applications`);
                    // Reload applications data
                    if (window.loadApplicationsData) {
                        window.loadApplicationsData();
                    }
                } else {
                    console.log('ℹ️ No applications need fixing');
                }
                
                return fixedCount;
            } catch (error) {
                console.error('Error fixing application names:', error);
                return -1;
            }
        };

        // Session management
        let sessionTimeout = null;
        let warningTimeout = null;
        let countdownInterval = null;
        const SESSION_DURATION = 10 * 60 * 1000; // 10 minutes
        const WARNING_TIME = 30 * 1000; // 30 seconds before logout

        // Session Management Functions
        const SessionManager = {
            startSession() {
                this.resetSession();
                this.setupActivityListeners();
            },

            resetSession() {
                // Clear existing timeouts
                if (sessionTimeout) clearTimeout(sessionTimeout);
                if (warningTimeout) clearTimeout(warningTimeout);
                if (countdownInterval) clearInterval(countdownInterval);
                
                // Hide warning if showing
                document.getElementById('auto-logout-warning').style.display = 'none';
                
                // Set new session timeout
                sessionTimeout = setTimeout(() => {
                    this.forceLogout();
                }, SESSION_DURATION);
                
                // Set warning timeout
                warningTimeout = setTimeout(() => {
                    this.showWarning();
                }, SESSION_DURATION - WARNING_TIME);
                
                console.log('Session reset - will expire in 10 minutes');
            },

            showWarning() {
                document.getElementById('auto-logout-warning').style.display = 'block';
                let countdown = 30;
                
                countdownInterval = setInterval(() => {
                    countdown--;
                    document.getElementById('logout-countdown').textContent = countdown;
                    
                    if (countdown <= 0) {
                        clearInterval(countdownInterval);
                        this.forceLogout();
                    }
                }, 1000);
            },

            extendSession() {
                document.getElementById('auto-logout-warning').style.display = 'none';
                if (countdownInterval) clearInterval(countdownInterval);
                this.resetSession();
                showSuccess('Session extended for another 10 minutes');
            },

            forceLogout() {
                if (countdownInterval) clearInterval(countdownInterval);
                document.getElementById('auto-logout-warning').style.display = 'none';
                
                // Log auto-logout activity
                if (currentUser) {
                    ActivityLogger.logActivity(
                        'LOGOUT',
                        'AUTHENTICATION',
                        currentUser.displayName || currentUser.email.split('@')[0],
                        {
                            email: currentUser.email,
                            logoutTime: new Date().toISOString(),
                            reason: 'Auto-logout due to inactivity'
                        }
                    );
                }
                
                signOut(auth).then(() => {
                    showError('Session expired due to inactivity. Please log in again.');
                    showLoginForm();
                    currentUser = null;
                });
            },

            setupActivityListeners() {
                // Reset session on any user activity
                const events = ['mousedown', 'mousemove', 'keypress', 'scroll', 'touchstart', 'click'];
                
                events.forEach(event => {
                    document.addEventListener(event, () => {
                        if (currentUser) {
                            this.resetSession();
                        }
                    }, true);
                });
            },

            clearSession() {
                if (sessionTimeout) clearTimeout(sessionTimeout);
                if (warningTimeout) clearTimeout(warningTimeout);
                if (countdownInterval) clearInterval(countdownInterval);
                document.getElementById('auto-logout-warning').style.display = 'none';
            }
        };

        // Email logging configuration
        let emailConfig = {
            serviceId: '',
            templateId: '',
            publicKey: '',
            notificationEmail: '',
            adminName: '',
            isConfigured: false
        };

        // Activity logging system
        const ActivityLogger = {
            // Initialize EmailJS
            init() {
                this.loadEmailConfig();
                if (emailConfig.isConfigured) {
                    emailjs.init(emailConfig.publicKey);
                }
            },

            // Load email configuration from localStorage
            loadEmailConfig() {
                const saved = localStorage.getItem('combest_email_config');
                if (saved) {
                    emailConfig = { ...emailConfig, ...JSON.parse(saved) };
                    this.updateEmailStatus();
                }
            },

            // Save email configuration
            saveEmailConfig(config) {
                emailConfig = { ...emailConfig, ...config, isConfigured: true };
                localStorage.setItem('combest_email_config', JSON.stringify(emailConfig));
                emailjs.init(emailConfig.publicKey);
                this.updateEmailStatus();
            },

            // Update email status display
            updateEmailStatus() {
                const statusElement = document.getElementById('email-status');
                const emailElement = document.getElementById('notification-email');
                
                if (emailConfig.isConfigured) {
                    statusElement.textContent = 'Configured';
                    statusElement.className = 'status-badge status-accepted';
                    emailElement.textContent = emailConfig.notificationEmail;
                } else {
                    statusElement.textContent = 'Not Configured';
                    statusElement.className = 'status-badge status-pending';
                    emailElement.textContent = 'Not set';
                }

                // Update email settings section stats
                this.updateEmailSettingsStats();
            },

            // Update email settings section statistics
            updateEmailSettingsStats() {
                const emailsSentElement = document.getElementById('emails-sent-settings');
                const configStatusElement = document.getElementById('email-config-status');
                const lastTestElement = document.getElementById('last-test-status');

                if (emailsSentElement) {
                    const emailsSent = parseInt(localStorage.getItem('combest_emails_sent') || '0');
                    emailsSentElement.textContent = emailsSent;
                }

                if (configStatusElement) {
                    configStatusElement.textContent = emailConfig.isConfigured ? '✅' : '❌';
                }

                if (lastTestElement) {
                    const lastTest = localStorage.getItem('combest_last_email_test');
                    if (lastTest) {
                        const testDate = new Date(lastTest);
                        lastTestElement.textContent = testDate.toLocaleDateString();
                    } else {
                        lastTestElement.textContent = 'Never';
                    }
                }
            },

            // Log activity to Firebase and send email
            async logActivity(action, type, itemName, details = {}) {
                const timestamp = new Date();
                const activity = {
                    action,
                    type,
                    itemName,
                    details,
                    adminEmail: currentUser?.email || 'Unknown',
                    adminName: currentUser?.displayName || currentUser?.email?.split('@')[0] || 'Unknown',
                    timestamp: serverTimestamp(),
                    localTimestamp: timestamp.toISOString(),
                    userAgent: navigator.userAgent,
                    ipAddress: 'Hidden for privacy'
                };

                try {
                    // Save to Firebase
                    await addDoc(collection(db, 'activityLogs'), activity);
                    
                    // Send email notification if configured
                    if (emailConfig.isConfigured) {
                        await this.sendEmailNotification(activity);
                    }
                    
                    console.log('Activity logged successfully:', activity);
                } catch (error) {
                    console.error('Error logging activity:', error);
                }
            },

            // Send email notification
            async sendEmailNotification(activity) {
                if (!emailConfig.isConfigured) return;

                const emailParams = {
                    to_email: emailConfig.notificationEmail,
                    admin_name: emailConfig.adminName,
                    activity_action: activity.action,
                    activity_type: activity.type,
                    item_name: activity.itemName,
                    admin_email: activity.adminEmail,
                    timestamp: new Date(activity.localTimestamp).toLocaleString(),
                    details: JSON.stringify(activity.details, null, 2),
                    user_agent: activity.userAgent
                };

                try {
                    await emailjs.send(
                        emailConfig.serviceId,
                        emailConfig.templateId,
                        emailParams
                    );
                    
                    // Update email sent counter
                    const emailsSent = parseInt(localStorage.getItem('combest_emails_sent') || '0') + 1;
                    localStorage.setItem('combest_emails_sent', emailsSent.toString());
                    
                    console.log('Email notification sent successfully');
                } catch (error) {
                    console.error('Error sending email notification:', error);
                }
            },

            // Test email service
            async testEmail() {
                if (!emailConfig.isConfigured) {
                    showError('Please configure email settings first');
                    return;
                }

                const testParams = {
                    to_email: emailConfig.notificationEmail,
                    admin_name: emailConfig.adminName,
                    activity_action: 'TEST',
                    activity_type: 'Email Service',
                    item_name: 'Test Email',
                    admin_email: currentUser?.email || 'test@example.com',
                    timestamp: new Date().toLocaleString(),
                    details: 'This is a test email to verify the email service is working correctly.',
                    user_agent: navigator.userAgent
                };

                try {
                    await emailjs.send(
                        emailConfig.serviceId,
                        emailConfig.templateId,
                        testParams
                    );
                    
                    // Record successful test
                    localStorage.setItem('combest_last_email_test', new Date().toISOString());
                    this.updateEmailSettingsStats();
                    
                    showSuccess('Test email sent successfully! Check your inbox.');
                } catch (error) {
                    console.error('Test email error:', error);
                    showError('Failed to send test email: ' + error.text);
                }
            }
        };

        // Make Firebase functions and objects globally accessible (after initialization)
        window.deleteDoc = deleteDoc;
        window.updateDoc = updateDoc;
        window.doc = doc;
        window.db = db;
        window.serverTimestamp = serverTimestamp;
        window.collection = collection;
        window.addDoc = addDoc;
        window.getDocs = getDocs;
        window.auth = auth;
        window.signOut = signOut;
        
        // Make other essential variables globally accessible
        window.currentItemType = currentItemType;
        window.currentItemId = currentItemId;
        window.ActivityLogger = ActivityLogger;
        window.showLoginForm = showLoginForm;
        window.showSuccess = showSuccess;
        window.showError = showError;

        // Authentication
        function checkAuth() {
            // Listen for auth state changes to handle refresh
            onAuthStateChanged(auth, (user) => {
                if (user) {
                    currentUser = user;
                    document.getElementById('welcome-text').textContent = `Welcome, ${user.displayName || user.email.split('@')[0]}!`;
                    hideLoginForm();
                    loadAllData();
                    
                    // Initialize activity logger
                    ActivityLogger.init();
                    
                    // Start session management
                    SessionManager.startSession();
                } else {
                    // Check URL parameters for direct login
            const urlParams = new URLSearchParams(window.location.search);
            const email = urlParams.get('email');
            const password = urlParams.get('password');

            if (email && password) {
                signInWithEmailAndPassword(auth, email, password)
                    .then((userCredential) => {
                        currentUser = userCredential.user;
                                // Auth state change will handle the rest
                    })
                    .catch((error) => {
                        showError('Login failed: ' + error.message);
                        showLoginForm();
                    });
            } else {
                showLoginForm();
            }
                }
            });
        }

        function showLoginForm() {
            document.getElementById('login-form').classList.add('show');
            document.getElementById('admin-content').style.display = 'none';
        }

        function hideLoginForm() {
            document.getElementById('login-form').classList.remove('show');
            document.getElementById('admin-content').style.display = 'block';
        }

        // Load all data with real-time listeners
        function loadAllData() {
            loadTestimonialsData();
            loadFoundersData();
            loadJobsData();
            loadGalleryData();
            loadMessagesData();
            loadApplicationsData();
            loadActivityLogsData();
        }

        // Individual data loading functions
        function loadTestimonialsData() {
            console.log('Loading testimonials data...');
            const testimonialsQuery = query(collection(db, 'testimonials'), orderBy('createdAt', 'desc'));
            onSnapshot(testimonialsQuery, (snapshot) => {
                console.log('Testimonials snapshot:', snapshot.docs.length, 'docs');
                allData.testimonials = [];
                snapshot.docs.forEach(doc => {
                    allData.testimonials.push({ id: doc.id, ...doc.data() });
                });
                renderTestimonials();
                updateDashboardStats();
            }, (error) => {
                console.error('Testimonials loading error:', error);
            });
        }

        function loadFoundersData() {
            console.log('Loading founders data...');
            const foundersQuery = query(collection(db, 'founders'), orderBy('createdAt', 'desc'));
            onSnapshot(foundersQuery, (snapshot) => {
                console.log('Founders snapshot:', snapshot.docs.length, 'docs');
                allData.founders = [];
                snapshot.docs.forEach(doc => {
                    allData.founders.push({ id: doc.id, ...doc.data() });
                });
                renderFounders();
                updateDashboardStats();
            }, (error) => {
                console.error('Founders loading error:', error);
            });
        }

        function loadJobsData() {
            const jobsQuery = query(collection(db, 'jobs'), orderBy('createdAt', 'desc'));
            onSnapshot(jobsQuery, (snapshot) => {
                allData.jobs = [];
                snapshot.docs.forEach(doc => {
                    allData.jobs.push({ id: doc.id, ...doc.data() });
                });
                renderJobs();
                renderJobPostingsOverview();
                updateDashboardStats();
            });
        }

        function loadGalleryData() {
            const galleryQuery = query(collection(db, 'gallery'), orderBy('createdAt', 'desc'));
            onSnapshot(galleryQuery, (snapshot) => {
                allData.gallery = [];
                snapshot.docs.forEach(doc => {
                    allData.gallery.push({ id: doc.id, ...doc.data() });
                });
                renderGallery();
                updateDashboardStats();
            });
        }

        function loadMessagesData() {
            console.log('Loading messages data...');
            const messagesQuery = query(collection(db, 'messages'), orderBy('createdAt', 'desc'));
            onSnapshot(messagesQuery, (snapshot) => {
                console.log('Messages snapshot:', snapshot.docs.length, 'docs');
                allData.messages = [];
                snapshot.docs.forEach(doc => {
                    console.log('Message doc:', doc.id, doc.data());
                    allData.messages.push({ id: doc.id, ...doc.data() });
                });
                console.log('Total messages loaded:', allData.messages.length);
                renderMessages();
                updateDashboardStats();
            }, (error) => {
                console.error('Messages loading error:', error);
            });
        }

        function loadApplicationsData() {
            console.log('Loading applications data...');
            const applicationsQuery = query(collection(db, 'applications'), orderBy('createdAt', 'desc'));
            onSnapshot(applicationsQuery, (snapshot) => {
                console.log('Applications snapshot:', snapshot.docs.length, 'docs');
                allData.applications = [];
                snapshot.docs.forEach(doc => {
                    console.log('Application doc:', doc.id, doc.data());
                    allData.applications.push({ id: doc.id, ...doc.data() });
                });
                console.log('Total applications loaded:', allData.applications.length);
                renderApplications();
                updateApplicationsStats();
                renderJobPostingsOverview();
                updateDashboardStats();
            }, (error) => {
                console.error('Applications loading error:', error);
            });
        }

        function loadActivityLogsData() {
            const logsQuery = query(collection(db, 'activityLogs'), orderBy('timestamp', 'desc'));
            onSnapshot(logsQuery, (snapshot) => {
                allData.activityLogs = [];
                snapshot.docs.forEach(doc => {
                    allData.activityLogs.push({ id: doc.id, ...doc.data() });
                });
                renderActivityLogs();
                updateActivityStats();
            });
        }

        // Make functions globally accessible after definition
        window.loadActivityLogsData = loadActivityLogsData;
        window.loadApplicationsData = loadApplicationsData;
        window.renderApplications = renderApplications;
        window.updateApplicationsStats = updateApplicationsStats;

        // Firebase configuration verification
        window.verifyFirebaseConfig = function() {
            console.log('🔍 Firebase Configuration Verification:');
            console.log('Project ID:', firebaseConfig.projectId);
            console.log('Auth Domain:', firebaseConfig.authDomain);
            console.log('API Key:', firebaseConfig.apiKey.substring(0, 10) + '...');
            console.log('Database instance:', db);
            console.log('Collection being used: "applications"');
            
            console.log('\n📊 Current applications data:');
            console.log('Applications in memory:', allData.applications.length);
            
            if (allData.applications.length > 0) {
                console.log('Sample application:', allData.applications[0]);
            }
            
            return {
                projectId: firebaseConfig.projectId,
                collection: 'applications',
                applicationsCount: allData.applications.length
            };
        };
        
        // Make loadMessagesData globally accessible for debugging
        window.loadMessagesData = loadMessagesData;
        window.renderMessages = renderMessages;

        // Render functions
        function renderTestimonials() {
            const grid = document.getElementById('testimonials-grid');
            grid.innerHTML = '';
            
            allData.testimonials.forEach(item => {
                const card = document.createElement('div');
                card.className = 'data-card';
                card.innerHTML = `
                    <div class="card-header">
                        <div class="card-title">${item.author}</div>
                        <div class="card-actions">
                            <button class="btn btn-edit" onclick="editItem('testimonials', '${item.id}')">Edit</button>
                            ${item.status === 'hidden' ? 
                                `<button class="btn btn-show" onclick="toggleTestimonialVisibility('${item.id}', 'hidden')">Show</button>` :
                                `<button class="btn btn-hide" onclick="toggleTestimonialVisibility('${item.id}', 'visible')">Hide</button>`
                            }
                            <button class="btn btn-delete" onclick="deleteItem('testimonials', '${item.id}')">Delete</button>
                        </div>
                    </div>
                    <p><strong>Location:</strong> ${item.location}</p>
                    <p><strong>Text:</strong> "${item.text}"</p>
                    <p><strong>Status:</strong> ${item.status || 'visible'}</p>
                `;
                grid.appendChild(card);
            });
        }

        function renderFounders() {
            const grid = document.getElementById('founders-grid');
            grid.innerHTML = '';
            
            allData.founders.forEach(item => {
                const card = document.createElement('div');
                card.className = 'data-card';
                card.innerHTML = `
                    <div class="card-header">
                        <div class="card-title">${item.name}</div>
                        <div class="card-actions">
                            <button class="btn btn-edit" onclick="editItem('founders', '${item.id}')">Edit</button>
                            ${item.status === 'hidden' ? 
                                `<button class="btn btn-show" onclick="toggleFounderVisibility('${item.id}', 'hidden')">Show</button>` :
                                `<button class="btn btn-hide" onclick="toggleFounderVisibility('${item.id}', 'visible')">Hide</button>`
                            }
                            <button class="btn btn-delete" onclick="deleteItem('founders', '${item.id}')">Delete</button>
                        </div>
                    </div>
                    <p><strong>Position:</strong> ${item.position}</p>
                    <p><strong>Bio:</strong> ${item.bio}</p>
                    ${item.imageUrl ? `<img src="${item.imageUrl}" alt="${item.name}" class="image-preview" style="width: 100px; height: 80px; object-fit: cover; margin-top: 10px;">` : ''}
                `;
                grid.appendChild(card);
            });
        }

        function renderJobs() {
            const grid = document.getElementById('jobs-grid');
            grid.innerHTML = '';
            
            allData.jobs.forEach(item => {
                const card = document.createElement('div');
                card.className = 'data-card';
                card.innerHTML = `
                    <div class="card-header">
                        <div class="card-title">${item.title}</div>
                        <div class="card-actions">
                            <button class="btn btn-edit" onclick="editItem('jobs', '${item.id}')">Edit</button>
                            ${item.status === 'hidden' ? 
                                `<button class="btn btn-show" onclick="toggleJobVisibility('${item.id}', 'hidden')">Show</button>` :
                                `<button class="btn btn-hide" onclick="toggleJobVisibility('${item.id}', 'visible')">Hide</button>`
                            }
                            <button class="btn btn-delete" onclick="deleteItem('jobs', '${item.id}')">Delete</button>
                        </div>
                    </div>
                    <p><strong>Location:</strong> ${item.location}</p>
                    <p><strong>Type:</strong> ${item.type}</p>
                    <p><strong>Salary:</strong> ${item.salary}</p>
                    <p><strong>Description:</strong> ${item.description}</p>
                `;
                grid.appendChild(card);
            });
        }

        function renderGallery() {
            const grid = document.getElementById('gallery-grid');
            grid.innerHTML = '';
            
            allData.gallery.forEach(item => {
                const card = document.createElement('div');
                card.className = 'data-card';
                card.innerHTML = `
                    <div class="card-header">
                        <div class="card-title">${item.title}</div>
                        <div class="card-actions">
                            <button class="btn btn-edit" onclick="editItem('gallery', '${item.id}')">Edit</button>
                            ${item.status === 'hidden' ? 
                                `<button class="btn btn-show" onclick="toggleGalleryVisibility('${item.id}', 'hidden')">Show</button>` :
                                `<button class="btn btn-hide" onclick="toggleGalleryVisibility('${item.id}', 'visible')">Hide</button>`
                            }
                            <button class="btn btn-delete" onclick="deleteItem('gallery', '${item.id}')">Delete</button>
                        </div>
                    </div>
                    <p><strong>Description:</strong> ${item.description}</p>
                    <p><strong>Category:</strong> ${item.category || 'Not specified'}</p>
                    <p><strong>Display Mode:</strong> ${item.displayMode || 'contain'}</p>
                    ${item.imageUrl ? `<div class="image-preview-container" style="margin-top: 10px;">
                        <img src="${item.imageUrl}" alt="${item.title}" class="image-preview" 
                             style="width: 150px; height: 100px; object-fit: ${item.displayMode || 'contain'}; border: 1px solid #ddd; border-radius: 8px; background: #f8f9fa;">
                        <small style="display: block; color: #666; margin-top: 5px;">Preview with ${item.displayMode || 'contain'} mode</small>
                    </div>` : ''}
                `;
                grid.appendChild(card);
            });
        }

        function renderMessages() {
            console.log('Rendering messages...', allData.messages.length, 'messages');
            const grid = document.getElementById('messages-grid');
            
            if (!grid) {
                console.error('Messages grid element not found!');
                return;
            }
            
            grid.innerHTML = '';
            
            if (allData.messages.length === 0) {
                console.log('No messages to display');
                const noDataMessage = document.createElement('div');
                noDataMessage.className = 'no-data-message';
                noDataMessage.innerHTML = `
                    <div class="no-data-content">
                        <h3>No Messages Yet</h3>
                        <p>Contact messages will appear here when customers submit the contact form.</p>
                    </div>
                `;
                grid.appendChild(noDataMessage);
                return;
            }
            
            allData.messages.forEach(item => {
                const card = document.createElement('div');
                card.className = 'data-card';
                card.innerHTML = `
                    <div class="card-header">
                        <div class="card-title">${item.name}</div>
                        <div class="card-actions">
                            <button class="btn btn-edit" onclick="editItem('messages', '${item.id}')">Reply</button>
                            <button class="btn btn-delete" onclick="deleteItem('messages', '${item.id}')">Delete</button>
                        </div>
                    </div>
                    <p><strong>Email:</strong> ${item.email}</p>
                    <p><strong>Phone:</strong> ${item.phone}</p>
                    <p><strong>Service:</strong> ${item.service || 'Not specified'}</p>
                    <p><strong>Received:</strong> ${item.createdAt ? new Date(item.createdAt.toDate()).toLocaleDateString() + ' ' + new Date(item.createdAt.toDate()).toLocaleTimeString() : 'Unknown'}</p>
                    <p><strong>Message:</strong> ${item.message}</p>
                    <p><strong>Status:</strong> <span class="status-badge status-${item.status || 'new'}">${item.status || 'new'}</span></p>
                `;
                grid.appendChild(card);
            });
        }

        function renderJobPostingsOverview() {
            const grid = document.getElementById('job-postings-overview');
            
            // Check if the element exists (it was removed in the new applications interface)
            if (!grid) {
                console.log('Job postings overview element not found - skipping render');
                return;
            }
            
            grid.innerHTML = '';
            
            if (allData.jobs.length === 0) {
                const noDataCard = document.createElement('div');
                noDataCard.className = 'data-card no-data-card';
                noDataCard.innerHTML = `
                    <div class="no-data-content">
                        <h3>No Job Postings Yet</h3>
                        <p>Create job postings in the Careers section to start receiving applications.</p>
                    </div>
                `;
                grid.appendChild(noDataCard);
                return;
            }
            
            allData.jobs.forEach(job => {
                // Count applications for this job
                const applicationsForJob = allData.applications.filter(app => 
                    app.position && app.position.toLowerCase().includes(job.title.toLowerCase())
                );
                
                const card = document.createElement('div');
                card.className = 'data-card job-posting-card';
                card.innerHTML = `
                    <div class="job-posting-header">
                        <div class="job-posting-title">${job.title}</div>
                        <div class="job-posting-actions">
                            <div class="application-stats">${applicationsForJob.length} application${applicationsForJob.length !== 1 ? 's' : ''}</div>
                            <div class="card-actions">
                                <button class="btn btn-edit" onclick="editItem('jobs', '${job.id}')">Edit</button>
                                ${job.status === 'hidden' ? 
                                    `<button class="btn btn-show" onclick="toggleJobVisibility('${job.id}', 'hidden')">Show</button>` :
                                    `<button class="btn btn-hide" onclick="toggleJobVisibility('${job.id}', 'visible')">Hide</button>`
                                }
                                <button class="btn btn-delete" onclick="deleteItem('jobs', '${job.id}')">Delete</button>
                            </div>
                        </div>
                    </div>
                    <div class="job-details">
                        <p><strong>Location:</strong> ${job.location}</p>
                        <p><strong>Type:</strong> ${job.type}</p>
                        <p><strong>Salary:</strong> ${job.salary}</p>
                        <p><strong>Posted:</strong> ${job.createdAt ? new Date(job.createdAt.toDate()).toLocaleDateString() : 'Unknown'}</p>
                        <p><strong>Status:</strong> <span class="status-badge status-${job.status || 'visible'}">${job.status || 'visible'}</span></p>
                        <p><strong>Description:</strong> ${job.description ? job.description.substring(0, 150) + (job.description.length > 150 ? '...' : '') : 'No description'}</p>
                    </div>
                `;
                grid.appendChild(card);
            });
        }

        function renderApplications() {
            console.log('Rendering applications...', allData.applications.length, 'applications');
            const tableBody = document.getElementById('applications-table-body');
            const emptyState = document.getElementById('applications-empty-state');
            const tableContainer = document.querySelector('.applications-table-container');
            
            if (!tableBody) {
                console.error('Applications table body element not found!');
                return;
            }
            
            // Clear existing content
            tableBody.innerHTML = '';
            
            // Populate position filter
            populatePositionFilter();
            
            if (allData.applications.length === 0) {
                console.log('No applications to display');
                tableContainer.style.display = 'none';
                emptyState.style.display = 'block';
                return;
            }
            
            tableContainer.style.display = 'block';
            emptyState.style.display = 'none';
            
            // Sort applications by date (newest first)
            const sortedApplications = [...allData.applications].sort((a, b) => {
                const dateA = a.createdAt ? a.createdAt.toDate() : new Date(0);
                const dateB = b.createdAt ? b.createdAt.toDate() : new Date(0);
                return dateB - dateA;
            });
            
            sortedApplications.forEach(app => {
                const row = document.createElement('tr');
                row.className = 'application-row';
                row.dataset.applicationId = app.id;
                
                // Debug name fields
                console.log('Application name fields for', app.id, ':', {
                    name: app.name,
                    firstName: app.firstName,
                    lastName: app.lastName,
                    fullName: app.fullName,
                    email: app.email
                });
                
                // Create a robust display name
                let displayName = 'Unknown';
                if (app.name && app.name.trim()) {
                    displayName = app.name.trim();
                } else if (app.fullName && app.fullName.trim()) {
                    displayName = app.fullName.trim();
                } else if (app.firstName || app.lastName) {
                    const first = app.firstName || '';
                    const last = app.lastName || '';
                    displayName = `${first} ${last}`.trim();
                } else if (app.email) {
                    // Fallback to email username if no name available
                    displayName = app.email.split('@')[0];
                }
                
                console.log('Final display name:', displayName);
                
                const status = app.status || 'pending';
                const appliedDate = app.createdAt ? new Date(app.createdAt.toDate()).toLocaleDateString() : 'Unknown';
                const experience = app.experience ? app.experience.substring(0, 50) + (app.experience.length > 50 ? '...' : '') : 'Not provided';
                
                row.innerHTML = `
                    <td>
                        <input type="checkbox" class="application-checkbox" value="${app.id}" onchange="toggleBulkActions()">
                    </td>
                    <td>
                        <div class="applicant-info-cell">
                            <div class="applicant-name">${displayName}</div>
                            <div class="applicant-email">${app.email || 'No email'}</div>
                            </div>
                    </td>
                    <td class="position-cell">${app.position || 'Unknown Position'}</td>
                    <td class="date-cell">${appliedDate}</td>
                    <td>
                        <span class="status-badge status-${status}">${status.charAt(0).toUpperCase() + status.slice(1)}</span>
                    </td>
                    <td class="cv-cell">
                        ${app.cvFileUrl ? `
                            <div class="cv-actions">
                                <button class="cv-btn cv-view" onclick="viewCV('${app.cvFileUrl}', '${app.cvFileName || 'CV'}')" title="View CV">
                                    👁️ View
                                </button>
                                <button class="cv-btn cv-download" onclick="downloadCV('${app.cvFileUrl}', '${app.cvFileName || 'CV'}')" title="Download CV">
                                    📥 Download
                                </button>
                        </div>
                            <small class="cv-info">${app.cvFileName || 'CV'}</small>
                        ` : `
                            <span class="no-cv">No CV uploaded</span>
                        `}
                    </td>
                    <td>
                        <div class="action-buttons">
                            <button class="action-btn action-btn-primary" onclick="viewApplicationDetails('${app.id}')" title="View Details">
                                👁️
                            </button>
                            <button class="action-btn action-btn-secondary" onclick="quickStatusUpdate('${app.id}', 'reviewing')" title="Move to Review">
                                📋
                            </button>
                            <button class="action-btn action-btn-success" onclick="quickStatusUpdate('${app.id}', 'interview')" title="Schedule Interview">
                                🎤
                            </button>
                            <button class="action-btn action-btn-danger" onclick="quickStatusUpdate('${app.id}', 'rejected')" title="Reject">
                                ❌
                            </button>
                        </div>
                    </td>
                `;

                tableBody.appendChild(row);
            });
        }

        function renderActivityLogs() {
            const tableBody = document.getElementById('activity-table-body');
            tableBody.innerHTML = '';
            
            if (allData.activityLogs.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td colspan="6" style="text-align: center; padding: 40px; color: #6c757d;">
                        <strong>No Activity Logs Yet</strong><br>
                        Admin activities will be logged here once you start using the system.
                    </td>
                `;
                tableBody.appendChild(row);
                return;
            }
            
            allData.activityLogs.forEach(log => {
                const row = document.createElement('tr');
                
                // Format timestamp
                const timestamp = log.timestamp ? 
                    new Date(log.timestamp.toDate()).toLocaleString() : 
                    new Date(log.localTimestamp).toLocaleString();
                
                // Format details
                let detailsText = '';
                if (log.details && Object.keys(log.details).length > 0) {
                    if (log.details.reason) {
                        detailsText = log.details.reason;
                    } else if (log.details.action) {
                        detailsText = `${log.details.action}: ${log.details.from} → ${log.details.to}`;
                    } else {
                        detailsText = JSON.stringify(log.details).substring(0, 100);
                    }
                }
                
                row.innerHTML = `
                    <td class="activity-time">${timestamp}</td>
                    <td><span class="activity-action-badge action-${log.action.toLowerCase()}">${log.action}</span></td>
                    <td>${log.type}</td>
                    <td class="activity-item">${log.itemName}</td>
                    <td class="activity-admin">${log.adminName}<br><small>${log.adminEmail}</small></td>
                    <td class="activity-details" title="${detailsText}">${detailsText}</td>
                `;
                tableBody.appendChild(row);
            });
        }

        function updateActivityStats() {
            const totalLogs = allData.activityLogs.length;
            const emailsSent = parseInt(localStorage.getItem('combest_emails_sent') || '0');
            
            // Count today's activities
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            const todayActivities = allData.activityLogs.filter(log => {
                const logDate = log.timestamp ? 
                    new Date(log.timestamp.toDate()) : 
                    new Date(log.localTimestamp);
                logDate.setHours(0, 0, 0, 0);
                return logDate.getTime() === today.getTime();
            }).length;
            
            document.getElementById('total-logs').textContent = totalLogs;
            document.getElementById('emails-sent').textContent = emailsSent;
            document.getElementById('recent-activities').textContent = todayActivities;
        }

        // Update dashboard stats
        function updateDashboardStats() {
            document.getElementById('testimonials-count').textContent = allData.testimonials.length;
            document.getElementById('founders-count').textContent = allData.founders.length;
            document.getElementById('jobs-count').textContent = allData.jobs.length;
            document.getElementById('gallery-count').textContent = allData.gallery.length;
            document.getElementById('messages-count').textContent = allData.messages.length;
            document.getElementById('applications-count').textContent = allData.applications.length;
            
            // Update applications section stats
            if (window.updateApplicationsStats) {
                window.updateApplicationsStats();
            }
        }

        // Update applications section statistics
        function updateApplicationsStats() {
            const totalApplications = allData.applications.length;
            const pendingApplications = allData.applications.filter(app => app.status === 'pending' || !app.status).length;
            const reviewingApplications = allData.applications.filter(app => app.status === 'reviewing').length;
            const interviewApplications = allData.applications.filter(app => app.status === 'interview').length;
            const hiredApplications = allData.applications.filter(app => app.status === 'hired').length;
            
            document.getElementById('total-applications').textContent = totalApplications;
            document.getElementById('pending-applications').textContent = pendingApplications;
            document.getElementById('reviewing-applications').textContent = reviewingApplications;
            document.getElementById('interview-applications').textContent = interviewApplications;
            document.getElementById('hired-applications').textContent = hiredApplications;
        }


        // Modal functions



        function getFormFields(type, item = null) {
            const fields = {
                testimonials: `
                    <div class="form-group">
                        <label>Author Name</label>
                        <input type="text" name="author" value="${item ? item.author : ''}" required>
                    </div>
                    <div class="form-group">
                        <label>Location</label>
                        <input type="text" name="location" value="${item ? item.location : ''}" required>
                    </div>
                    <div class="form-group">
                        <label>Testimonial Text</label>
                        <textarea name="text" required>${item ? item.text : ''}</textarea>
                    </div>
                    <div class="form-group">
                        <label>Status</label>
                        <select name="status">
                            <option value="visible" ${item && item.status === 'visible' ? 'selected' : ''}>Visible</option>
                            <option value="hidden" ${item && item.status === 'hidden' ? 'selected' : ''}>Hidden</option>
                        </select>
                    </div>
                `,
                founders: `
                    <div class="form-group">
                        <label>Name</label>
                        <input type="text" name="name" value="${item ? item.name : ''}" required>
                    </div>
                    <div class="form-group">
                        <label>Position</label>
                        <input type="text" name="position" value="${item ? item.position : ''}" required>
                    </div>
                    <div class="form-group">
                        <label>Bio</label>
                        <textarea name="bio" required>${item ? item.bio : ''}</textarea>
                    </div>
                    <div class="form-group">
                        <label>Image URL</label>
                        <input type="url" name="imageUrl" value="${item ? item.imageUrl : ''}" placeholder="https://example.com/image.jpg">
                        <div id="image-preview-container"></div>
                    </div>
                `,
                jobs: `
                    <div class="form-group">
                        <label>Job Title</label>
                        <input type="text" name="title" value="${item ? item.title : ''}" required>
                    </div>
                    <div class="form-group">
                        <label>Location</label>
                        <input type="text" name="location" value="${item ? item.location : ''}" required>
                    </div>
                    <div class="form-group">
                        <label>Job Type</label>
                        <select name="type" required>
                            <option value="Full-time" ${item && item.type === 'Full-time' ? 'selected' : ''}>Full-time</option>
                            <option value="Part-time" ${item && item.type === 'Part-time' ? 'selected' : ''}>Part-time</option>
                            <option value="Contract" ${item && item.type === 'Contract' ? 'selected' : ''}>Contract</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Salary</label>
                        <input type="text" name="salary" value="${item ? item.salary : ''}" required>
                    </div>
                    <div class="form-group">
                        <label>Description</label>
                        <textarea name="description" required>${item ? item.description : ''}</textarea>
                    </div>
                    <div class="form-group">
                        <label>Requirements</label>
                        <textarea name="requirements" required>${item ? item.requirements : ''}</textarea>
                    </div>
                `,
                gallery: `
                    <div class="form-group">
                        <label>Title</label>
                        <input type="text" name="title" value="${item ? item.title : ''}" required>
                    </div>
                    <div class="form-group">
                        <label>Description</label>
                        <textarea name="description" required>${item ? item.description : ''}</textarea>
                    </div>
                    <div class="form-group">
                        <label>Category</label>
                        <select name="category" required>
                            <option value="residential" ${item && item.category === 'residential' ? 'selected' : ''}>Residential</option>
                            <option value="commercial" ${item && item.category === 'commercial' ? 'selected' : ''}>Commercial</option>
                            <option value="specialized" ${item && item.category === 'specialized' ? 'selected' : ''}>Specialized</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Image Display Mode</label>
                        <select name="displayMode">
                            <option value="contain" ${item && item.displayMode === 'contain' ? 'selected' : 'selected'}>Contain (Show full image, no cropping)</option>
                            <option value="cover" ${item && item.displayMode === 'cover' ? 'selected' : ''}>Cover (Fill container, may crop)</option>
                            <option value="fill" ${item && item.displayMode === 'fill' ? 'selected' : ''}>Fill (Stretch to fit)</option>
                        </select>
                        <small style="color: #666; font-size: 0.9em;">
                            <strong>Contain:</strong> Shows the complete image without cropping (recommended for professional display)<br>
                            <strong>Cover:</strong> Fills the container but may crop parts of the image<br>
                            <strong>Fill:</strong> Stretches the image to fit exactly (may distort)
                        </small>
                    </div>
                    <div class="form-group">
                        <label>Image URL</label>
                        <input type="url" name="imageUrl" value="${item ? item.imageUrl : ''}" placeholder="https://example.com/image.jpg" required>
                        <div id="image-preview-container"></div>
                    </div>
                `,
                messages: `
                    <div class="form-group">
                        <label>Name</label>
                        <input type="text" name="name" value="${item ? item.name : ''}" readonly>
                    </div>
                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" name="email" value="${item ? item.email : ''}" readonly>
                    </div>
                    <div class="form-group">
                        <label>Phone</label>
                        <input type="text" name="phone" value="${item ? item.phone : ''}" readonly>
                    </div>
                    <div class="form-group">
                        <label>Message</label>
                        <textarea name="message" readonly>${item ? item.message : ''}</textarea>
                    </div>
                    <div class="form-group">
                        <label>Status</label>
                        <select name="status">
                            <option value="new" ${item && item.status === 'new' ? 'selected' : ''}>New</option>
                            <option value="replied" ${item && item.status === 'replied' ? 'selected' : ''}>Replied</option>
                            <option value="closed" ${item && item.status === 'closed' ? 'selected' : ''}>Closed</option>
                        </select>
                    </div>
                `,
                applications: `
                    <div class="form-group">
                        <label>Full Name</label>
                        <input type="text" name="fullName" value="${item ? item.fullName : ''}" readonly>
                    </div>
                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" name="email" value="${item ? item.email : ''}" readonly>
                    </div>
                    <div class="form-group">
                        <label>Phone</label>
                        <input type="text" name="phone" value="${item ? item.phone : ''}" readonly>
                    </div>
                    <div class="form-group">
                        <label>Position Applied For</label>
                        <input type="text" name="position" value="${item ? item.position : ''}" readonly>
                    </div>
                    <div class="form-group">
                        <label>Experience</label>
                        <textarea name="experience" readonly>${item ? item.experience || 'Not provided' : ''}</textarea>
                    </div>
                    <div class="form-group">
                        <label>Cover Letter</label>
                        <textarea name="coverLetter" readonly>${item ? item.coverLetter || 'No cover letter provided' : ''}</textarea>
                    </div>
                    <div class="form-group">
                        <label>Application Date</label>
                        <input type="text" value="${item && item.createdAt ? new Date(item.createdAt.toDate()).toLocaleDateString() : 'Unknown'}" readonly>
                    </div>
                    <div class="form-group">
                        <label>Application Status</label>
                        <select name="status">
                            <option value="pending" ${item && item.status === 'pending' ? 'selected' : ''}>Pending Review</option>
                            <option value="reviewed" ${item && item.status === 'reviewed' ? 'selected' : ''}>Under Review</option>
                            <option value="accepted" ${item && item.status === 'accepted' ? 'selected' : ''}>Accepted</option>
                            <option value="rejected" ${item && item.status === 'rejected' ? 'selected' : ''}>Rejected</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Admin Notes</label>
                        <textarea name="adminNotes" placeholder="Add notes about this application...">${item ? item.adminNotes || '' : ''}</textarea>
                    </div>
                `
            };
            return fields[type] || '';
        }

        // Form submission
        document.getElementById('modal-form').addEventListener('submit', function(e) {
            e.preventDefault();
            console.log('Form submitted');
            
            // Validate that we have a current item type
            if (!window.currentItemType) {
                console.error('No current item type set');
                showError('Error: No item type specified. Please try again.');
                return;
            }
            
            const formData = new FormData(this);
            const data = Object.fromEntries(formData.entries());
            console.log('Form data:', data);
            console.log('Current item type:', window.currentItemType);
            console.log('Current item ID:', window.currentItemId);
            
            if (window.currentItemId) {
                // Update existing item
                console.log('Updating existing item');
                const oldItem = allData[window.currentItemType].find(item => item.id === window.currentItemId);
                updateDoc(doc(db, window.currentItemType, window.currentItemId), {
                    ...data,
                    updatedAt: serverTimestamp()
                }).then(() => {
                    console.log('Item updated successfully');
                    
                    // Log activity
                    ActivityLogger.logActivity(
                        'UPDATE',
                        window.currentItemType.toUpperCase(),
                        data.name || data.title || data.author || data.fullName || 'Unknown Item',
                        {
                            itemId: window.currentItemId,
                            changes: data,
                            previousData: oldItem
                        }
                    );
                    
                    showSuccess('Great! Item updated successfully!');
                    closeModal();
                }).catch(error => {
                    console.error('Update error:', error);
                    showError('Oops! Could not update item. Please try again.');
                });
            } else {
                // Add new item
                console.log('Adding new item');
                addDoc(collection(db, window.currentItemType), {
                    ...data,
                    createdAt: serverTimestamp(),
                    updatedAt: serverTimestamp()
                }).then((docRef) => {
                    console.log('Item added successfully');
                    
                    // Log activity
                    ActivityLogger.logActivity(
                        'CREATE',
                        window.currentItemType.toUpperCase(),
                        data.name || data.title || data.author || data.fullName || 'New Item',
                        {
                            itemId: docRef.id,
                            itemData: data
                        }
                    );
                    
                    showSuccess('Perfect! New item added successfully!');
                    closeModal();
                }).catch(error => {
                    console.error('Add error:', error);
                    showError('Sorry! Could not add item. Please try again.');
                });
            }
        });








        // Login form submission
        document.getElementById('login-form-element').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            const submitBtn = document.getElementById('login-submit-btn');
            const errorDiv = document.getElementById('login-error');
            
            // Disable button and show loading
            submitBtn.disabled = true;
            submitBtn.textContent = 'Logging in...';
            errorDiv.style.display = 'none';
            
            signInWithEmailAndPassword(auth, email, password)
                .then((userCredential) => {
                    currentUser = userCredential.user;
                    document.getElementById('welcome-text').textContent = `Welcome, ${currentUser.displayName || currentUser.email.split('@')[0]}!`;
                    hideLoginForm();
                    loadAllData();
                        
                        // Initialize activity logger
                        ActivityLogger.init();
                        
                        // Start session management
                        SessionManager.startSession();
                        
                        // Log login activity
                        ActivityLogger.logActivity(
                            'LOGIN',
                            'AUTHENTICATION',
                            currentUser.displayName || currentUser.email.split('@')[0],
                            {
                                email: currentUser.email,
                                loginTime: new Date().toISOString()
                            }
                        );
                        
                    showSuccess('Login successful!');
                })
                .catch((error) => {
                    let friendlyMessage = 'Login failed. Please check your credentials and try again.';
                    if (error.code === 'auth/user-not-found') {
                        friendlyMessage = 'No account found with this email address.';
                    } else if (error.code === 'auth/wrong-password') {
                        friendlyMessage = 'Incorrect password. Please try again.';
                    } else if (error.code === 'auth/invalid-email') {
                        friendlyMessage = 'Please enter a valid email address.';
                    } else if (error.code === 'auth/too-many-requests') {
                        friendlyMessage = 'Too many failed attempts. Please try again later.';
                    }
                    errorDiv.textContent = friendlyMessage;
                    errorDiv.style.display = 'block';
                })
                .finally(() => {
                    submitBtn.disabled = false;
                    submitBtn.textContent = 'Login';
                });
        });

        // Logout function moved to global scope for HTML onclick access

        // Show success/error messages
        function showSuccess(message) {
            const successDiv = document.getElementById('success-message');
            const errorDiv = document.getElementById('error-message');
            
            // Hide any existing error message
            errorDiv.classList.remove('show');
            
            // Set success message content
            successDiv.innerHTML = `
                <span class="message-icon">✅</span>
                <span class="message-content">${message}</span>
                <button class="message-close" onclick="hideMessage('success')">&times;</button>
            `;
            
            // Add click-to-dismiss functionality
            successDiv.onclick = function(e) {
                if (e.target !== successDiv.querySelector('.message-close')) {
                    hideMessage('success');
                }
            };
            
            // Show success message with slight delay for smooth transition
            setTimeout(() => {
                successDiv.classList.add('show');
            }, 100);
            
            // Auto-hide after 5 seconds
            setTimeout(() => {
                hideMessage('success');
            }, 5000);
        }

        function showError(message) {
            const successDiv = document.getElementById('success-message');
            const errorDiv = document.getElementById('error-message');
            
            // Hide any existing success message
            successDiv.classList.remove('show');
            
            // Set error message content
            errorDiv.innerHTML = `
                <span class="message-icon">⚠️</span>
                <span class="message-content">${message}</span>
                <button class="message-close" onclick="hideMessage('error')">&times;</button>
            `;
            
            // Add click-to-dismiss functionality
            errorDiv.onclick = function(e) {
                if (e.target !== errorDiv.querySelector('.message-close')) {
                    hideMessage('error');
                }
            };
            
            // Show error message with slight delay for smooth transition
            setTimeout(() => {
                errorDiv.classList.add('show');
            }, 100);
            
            // Auto-hide after 5 seconds
            setTimeout(() => {
                hideMessage('error');
            }, 5000);
        }

        // Hide message function
        function hideMessage(type) {
            const messageDiv = document.getElementById(type === 'success' ? 'success-message' : 'error-message');
            messageDiv.classList.remove('show');
        }

        // Email configuration form submission
        document.getElementById('email-config-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            const config = Object.fromEntries(formData.entries());
            
            ActivityLogger.saveEmailConfig(config);
            closeEmailConfigModal();
            showSuccess('Email configuration saved successfully!');
        });

        // Filter activity logs function moved to global scope

        // Global session management functions
        function extendSession() {
            if (typeof SessionManager !== 'undefined') {
                SessionManager.extendSession();
            }
        }

        function logoutNow() {
            if (typeof SessionManager !== 'undefined') {
                SessionManager.forceLogout();
            }
        }

        // Logout function moved to beginning of global script section

        // Global email functions
        function testEmailService() {
            if (typeof ActivityLogger !== 'undefined') {
                ActivityLogger.testEmail();
            } else {
                showError('Email service not available. Please reload the page.');
            }
        }

        function openEmailConfigModal() {
            document.getElementById('email-config-modal').style.display = 'block';
            
            // Load current configuration if available
            if (typeof emailConfig !== 'undefined' && emailConfig.isConfigured) {
                document.getElementById('email-service-id').value = emailConfig.serviceId || '';
                document.getElementById('email-template-id').value = emailConfig.templateId || '';
                document.getElementById('email-public-key').value = emailConfig.publicKey || '';
                document.getElementById('notification-email-input').value = emailConfig.notificationEmail || '';
                document.getElementById('admin-name-input').value = emailConfig.adminName || '';
            }
        }

        function closeEmailConfigModal() {
            document.getElementById('email-config-modal').style.display = 'none';
        }


        // Make essential functions globally accessible (after all functions are defined)
        window.showSuccess = showSuccess;
        window.showError = showError;
        window.getFormFields = getFormFields;

        // Initialize
        checkAuth();
    </script>

    <!-- Global Functions -->
    <script>
        // Global logout function for header button (defined first for immediate availability)
        function logout() {
            // Check if we have access to Firebase auth and other functions
            if (typeof window.auth !== 'undefined' && typeof window.signOut !== 'undefined') {
                // Log logout activity if available
                if (typeof window.ActivityLogger !== 'undefined' && window.auth.currentUser) {
                    const currentUser = window.auth.currentUser;
                    window.ActivityLogger.logActivity(
                        'LOGOUT',
                        'AUTHENTICATION',
                        currentUser.displayName || currentUser.email.split('@')[0],
                        {
                            email: currentUser.email,
                            logoutTime: new Date().toISOString()
                        }
                    );
                }
                
                // Sign out
                window.signOut(window.auth).then(() => {
                    // Clear session management
                    if (typeof SessionManager !== 'undefined') {
                        SessionManager.clearSession();
                    }
                    
                    showSuccess('See you later! Logged out successfully!');
                    showLoginForm();
                    
                    // Clear login form
                    const emailInput = document.getElementById('login-email');
                    const passwordInput = document.getElementById('login-password');
                    const errorDiv = document.getElementById('login-error');
                    
                    if (emailInput) emailInput.value = '';
                    if (passwordInput) passwordInput.value = '';
                    if (errorDiv) errorDiv.style.display = 'none';
                }).catch((error) => {
                    console.error('Logout error:', error);
                    showError('Error logging out. Please try again.');
                });
            } else {
                // Fallback if Firebase isn't available
                console.error('Firebase auth not available for logout');
                showError('Unable to logout. Please refresh the page and try again.');
            }
        }

        // CSV Download function (Global scope for onclick access)
        function downloadActivityCSV() {
            try {
                if (!window.allData || !window.allData.activityLogs || window.allData.activityLogs.length === 0) {
                    showError('No activity logs available to download. Please wait for data to load or perform some activities first.');
                    return;
                }

                console.log('Starting CSV download with', window.allData.activityLogs.length, 'records');

                // Prepare CSV data with BOM for proper Excel encoding
                const headers = ['Timestamp', 'Action', 'Type', 'Item', 'Admin Name', 'Admin Email', 'Details'];
                const csvData = [headers];

                window.allData.activityLogs.forEach((log, index) => {
                    try {
                        // Format timestamp safely
                        let timestamp = 'Unknown';
                        if (log.timestamp && log.timestamp.toDate) {
                            timestamp = new Date(log.timestamp.toDate()).toLocaleString();
                        } else if (log.localTimestamp) {
                            timestamp = new Date(log.localTimestamp).toLocaleString();
                        }
                        
                        // Format details safely
                        let detailsText = '';
                        if (log.details && typeof log.details === 'object') {
                            if (log.details.reason) {
                                detailsText = log.details.reason;
                            } else if (log.details.action) {
                                detailsText = `${log.details.action}: ${log.details.from || 'N/A'} → ${log.details.to || 'N/A'}`;
                            } else {
                                detailsText = JSON.stringify(log.details);
                            }
                        }

                        csvData.push([
                            timestamp || 'Unknown',
                            log.action || 'Unknown',
                            log.type || 'Unknown',
                            log.itemName || 'Unknown',
                            log.adminName || 'Unknown',
                            log.adminEmail || 'Unknown',
                            detailsText
                        ]);
                    } catch (logError) {
                        console.error('Error processing log entry', index, ':', logError);
                        // Add error row instead of failing completely
                        csvData.push([
                            'Error processing entry',
                            'ERROR',
                            'SYSTEM',
                            'Log Processing Error',
                            'System',
                            'system@error',
                            `Error: ${logError.message}`
                        ]);
                    }
                });

                // Convert to CSV string with proper escaping
                const csvString = csvData.map(row => 
                    row.map(field => {
                        const stringField = String(field || '');
                        // Escape quotes and wrap in quotes if contains comma, quote, or newline
                        if (stringField.includes(',') || stringField.includes('"') || stringField.includes('\n')) {
                            return `"${stringField.replace(/"/g, '""')}"`;
                        }
                        return stringField;
                    }).join(',')
                ).join('\n');

                // Add BOM for proper Excel encoding
                const BOM = '\uFEFF';
                const csvWithBOM = BOM + csvString;

                // Create and download file
                const blob = new Blob([csvWithBOM], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement('a');
                
                // Check if browser supports download
                if (link.download === undefined) {
                    showError('Your browser does not support file downloads. Please try a different browser.');
                    return;
                }

                const url = URL.createObjectURL(blob);
                const fileName = `combest_activity_logs_${new Date().toISOString().split('T')[0]}.csv`;
                
                link.setAttribute('href', url);
                link.setAttribute('download', fileName);
                link.style.visibility = 'hidden';
                document.body.appendChild(link);
                
                // Trigger download
                link.click();
                
                // Cleanup
                setTimeout(() => {
                    document.body.removeChild(link);
                    URL.revokeObjectURL(url);
                }, 100);

                showSuccess(`Activity logs downloaded successfully! (${window.allData.activityLogs.length} records)`);
                
                // Log the download activity (if ActivityLogger is available)
                if (window.ActivityLogger && window.ActivityLogger.logActivity) {
                    window.ActivityLogger.logActivity(
                        'DOWNLOAD',
                        'SYSTEM',
                        'Activity Logs CSV',
                        {
                            recordCount: window.allData.activityLogs.length,
                            fileName: fileName,
                            downloadTime: new Date().toISOString()
                        }
                    );
                }

            } catch (error) {
                console.error('CSV Download Error:', error);
                showError(`Failed to download CSV: ${error.message}. Please try again or contact support.`);
            }
        }

        // Refresh activity logs function (Global scope)
        function refreshActivityLogs() {
            if (window.loadActivityLogsData) {
                window.loadActivityLogsData();
                showSuccess('Activity logs refreshed!');
            } else {
                showError('Unable to refresh logs. Please reload the page.');
            }
        }

        // Application Processing Functions (Global scope)
        
        // Toggle bulk actions visibility
        function toggleBulkActions() {
            const checkboxes = document.querySelectorAll('.application-checkbox:checked');
            const bulkActions = document.getElementById('bulk-actions');
            
            if (checkboxes.length > 0) {
                bulkActions.style.display = 'flex';
            } else {
                bulkActions.style.display = 'none';
            }
        }

        // Toggle select all applications
        function toggleSelectAll() {
            const selectAllCheckbox = document.getElementById('select-all-applications');
            const applicationCheckboxes = document.querySelectorAll('.application-checkbox');
            
            applicationCheckboxes.forEach(checkbox => {
                checkbox.checked = selectAllCheckbox.checked;
            });
            
            toggleBulkActions();
        }

        // Quick status update
        function quickStatusUpdate(applicationId, newStatus) {
            if (!window.updateDoc || !window.doc || !window.db || !window.serverTimestamp) {
                showError('Firebase functions not available. Please reload the page.');
                return;
            }

            const application = allData.applications.find(app => app.id === applicationId);
            if (!application) {
                showError('Application not found.');
                return;
            }

            const oldStatus = application.status || 'pending';
            
            updateDoc(doc(db, 'applications', applicationId), {
                status: newStatus,
                updatedAt: serverTimestamp()
            }).then(() => {
                // Update local data
                application.status = newStatus;
                
                // Log activity
                if (window.ActivityLogger) {
                    ActivityLogger.logActivity(
                        'STATUS_CHANGE',
                        'APPLICATION',
                        application.fullName || 'Unknown Applicant',
                        {
                            applicationId: applicationId,
                            position: application.position,
                            from: oldStatus,
                            to: newStatus
                        }
                    );
                }
                
                // Re-render applications and update stats
                renderApplications();
                window.updateApplicationsStats();
                
                showSuccess(`Application status updated to ${newStatus.charAt(0).toUpperCase() + newStatus.slice(1)}`);
            }).catch(error => {
                console.error('Error updating application status:', error);
                showError('Failed to update application status. Please try again.');
            });
        }

        // View application details
        function viewApplicationDetails(applicationId) {
            const application = allData.applications.find(app => app.id === applicationId);
            if (!application) {
                showError('Application not found.');
                return;
            }

            // Store current application for modal
            window.currentApplication = application;
            
            // Populate modal with application data - Fixed name logic
            const applicantName = application.name || application.fullName || 
                                (application.firstName && application.lastName ? `${application.firstName} ${application.lastName}` : 
                                 application.firstName || application.lastName) || 
                                (application.email ? application.email.split('@')[0] : 'Unknown');
            
            document.getElementById('applicant-name').textContent = applicantName;
            document.getElementById('applicant-email').textContent = application.email || 'No email';
            document.getElementById('applicant-phone').textContent = application.phone || 'No phone';
            document.getElementById('applicant-position').textContent = application.position || 'Unknown Position';
            document.getElementById('applicant-date').textContent = application.createdAt ? 
                new Date(application.createdAt.toDate()).toLocaleDateString() : 'Unknown';
            
            // Set status dropdown
            document.getElementById('application-status-select').value = application.status || 'pending';
            
            // Populate details tab
            document.getElementById('applicant-experience').textContent = application.experience || 'No experience provided';
            document.getElementById('applicant-cover-letter').textContent = application.coverLetter || 'No cover letter provided';
            
            // Handle CV/Resume section - Enhanced
            const resumeSection = document.getElementById('resume-section');
            
            if (application.cvFileUrl) {
                resumeSection.style.display = 'block';
                
                // Populate CV info
                document.getElementById('cv-filename').textContent = application.cvFileName || 'Resume.pdf';
                document.getElementById('cv-filesize').textContent = application.cvFileSize ? 
                    formatFileSize(application.cvFileSize) : '--';
                document.getElementById('cv-upload-date').textContent = application.createdAt ? 
                    new Date(application.createdAt.toDate()).toLocaleDateString() : '--';
                
                // Set up CV action buttons
                const viewBtn = document.getElementById('resume-view-btn');
                const downloadBtn = document.getElementById('resume-download-btn');
                const openBtn = document.getElementById('resume-open-btn');
                
                viewBtn.onclick = () => viewCVInModal();
                downloadBtn.onclick = () => downloadCVFromModal();
                openBtn.onclick = () => window.open(application.cvFileUrl, '_blank');
                
                // Store CV data for modal functions
                window.currentCVData = {
                    url: application.cvFileUrl,
                    filename: application.cvFileName || 'Resume.pdf'
                };
            } else {
                resumeSection.style.display = 'none';
            }
            
            // Populate notes tab
            document.getElementById('application-notes').value = application.adminNotes || '';
            
            // Load notes history
            loadNotesHistory(applicationId);
            
            // Load application history
            loadApplicationHistory(applicationId);
            
            // Show modal
            document.getElementById('application-detail-modal').style.display = 'block';
        }

        // Switch application detail tabs
        function switchApplicationTab(tabName) {
            // Remove active class from all tabs and panes
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-pane').forEach(pane => pane.classList.remove('active'));
            
            // Add active class to selected tab and pane
            document.querySelector(`[onclick="switchApplicationTab('${tabName}')"]`).classList.add('active');
            document.getElementById(`${tabName}-tab`).classList.add('active');
        }

        // Update application status from modal
        function updateApplicationStatus() {
            if (!window.currentApplication) return;
            
            const newStatus = document.getElementById('application-status-select').value;
            quickStatusUpdate(window.currentApplication.id, newStatus);
        }

        // Save application notes
        function saveApplicationNotes() {
            if (!window.currentApplication) return;
            
            const notes = document.getElementById('application-notes').value;
            
            if (!window.updateDoc || !window.doc || !window.db || !window.serverTimestamp) {
                showError('Firebase functions not available. Please reload the page.');
                return;
            }
            
            updateDoc(doc(db, 'applications', window.currentApplication.id), {
                adminNotes: notes,
                updatedAt: serverTimestamp()
            }).then(() => {
                // Update local data
                window.currentApplication.adminNotes = notes;
                
                // Log activity
                if (window.ActivityLogger) {
                    ActivityLogger.logActivity(
                        'NOTE_ADDED',
                        'APPLICATION',
                        window.currentApplication.fullName || 'Unknown Applicant',
                        {
                            applicationId: window.currentApplication.id,
                            notePreview: notes.substring(0, 100)
                        }
                    );
                }
                
                showSuccess('Notes saved successfully!');
                loadNotesHistory(window.currentApplication.id);
            }).catch(error => {
                console.error('Error saving notes:', error);
                showError('Failed to save notes. Please try again.');
            });
        }

        // Load notes history (placeholder - would need additional Firebase collection)
        function loadNotesHistory(applicationId) {
            const notesHistory = document.getElementById('notes-history');
            notesHistory.innerHTML = '<p style="color: #666; font-style: italic;">Notes history feature coming soon...</p>';
        }

        // Load application history (placeholder - would need additional Firebase collection)
        function loadApplicationHistory(applicationId) {
            const historyContainer = document.getElementById('application-history');
            historyContainer.innerHTML = '<p style="color: #666; font-style: italic;">Application history feature coming soon...</p>';
        }

        // Schedule interview
        function scheduleInterview() {
            if (!window.currentApplication) return;
            
            // Pre-fill interview form with application data
            const today = new Date();
            const tomorrow = new Date(today);
            tomorrow.setDate(tomorrow.getDate() + 1);
            
            document.querySelector('[name="interviewDate"]').value = tomorrow.toISOString().split('T')[0];
            document.querySelector('[name="interviewTime"]').value = '10:00';
            
            // Show interview modal
            document.getElementById('interview-modal').style.display = 'block';
        }

        // Send application email
        function sendApplicationEmail() {
            if (!window.currentApplication) return;
            
            // Pre-populate email form
            document.getElementById('email-subject').value = `Re: Your Application for ${window.currentApplication.position || 'Position'}`;
            
            // Show email modal
            document.getElementById('email-template-modal').style.display = 'block';
        }

        // Export application as PDF (placeholder)
        function exportApplicationPDF() {
            if (!window.currentApplication) return;
            
            showError('PDF export feature coming soon...');
        }

        // Reject application
        function rejectApplication() {
            if (!window.currentApplication) return;
            
            if (confirm('Are you sure you want to reject this application? This action cannot be undone.')) {
                quickStatusUpdate(window.currentApplication.id, 'rejected');
                closeApplicationDetailModal();
            }
        }

        // Helper function to format file size
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        // CV Modal Functions
        function viewCVInModal() {
            if (!window.currentCVData) {
                showError('CV data not available');
                return;
            }
            
            const previewContainer = document.getElementById('cv-preview-container');
            const previewFrame = document.getElementById('cv-preview-frame');
            
            // Toggle preview
            if (previewContainer.style.display === 'none' || !previewContainer.style.display) {
                previewFrame.src = window.currentCVData.url;
                previewContainer.style.display = 'block';
                document.getElementById('resume-view-btn').textContent = '🙈 Hide Preview';
            } else {
                previewContainer.style.display = 'none';
                previewFrame.src = '';
                document.getElementById('resume-view-btn').textContent = '👁️ View CV';
            }
        }

        function downloadCVFromModal() {
            if (!window.currentCVData) {
                showError('CV data not available');
                return;
            }
            downloadCV(window.currentCVData.url, window.currentCVData.filename);
        }

        // Close application detail modal
        function closeApplicationDetailModal() {
            document.getElementById('application-detail-modal').style.display = 'none';
            window.currentApplication = null;
            window.currentCVData = null;
            
            // Hide CV preview if open
            const previewContainer = document.getElementById('cv-preview-container');
            if (previewContainer) {
                previewContainer.style.display = 'none';
                document.getElementById('cv-preview-frame').src = '';
                document.getElementById('resume-view-btn').textContent = '👁️ View CV';
            }
        }

        // Close interview modal
        function closeInterviewModal() {
            document.getElementById('interview-modal').style.display = 'none';
        }

        // Close email template modal
        function closeEmailTemplateModal() {
            document.getElementById('email-template-modal').style.display = 'none';
        }

        // Document Management Functions
        function openDocumentModal() {
            document.getElementById('document-modal').style.display = 'block';
            resetDocumentForm();
        }

        function closeDocumentModal() {
            document.getElementById('document-modal').style.display = 'none';
            resetDocumentForm();
        }

        function resetDocumentForm() {
            document.getElementById('document-form').reset();
            document.getElementById('file-preview').style.display = 'none';
            document.getElementById('document-visible').checked = true;
        }

        // File upload preview
        document.getElementById('document-file').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                if (file.type !== 'application/pdf') {
                    showError('Please select a PDF file.');
                    return;
                }
                
                if (file.size > 10 * 1024 * 1024) { // 10MB limit
                    showError('File size must be less than 10MB.');
                    return;
                }

                // Show file preview
                const preview = document.getElementById('file-preview');
                const fileInfo = document.getElementById('file-info');
                
                fileInfo.textContent = `File: ${file.name} (${formatFileSize(file.size)})`;
                preview.style.display = 'block';
            }
        });

        // Document form submission
        document.getElementById('document-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            const file = document.getElementById('document-file').files[0];
            
            if (!file) {
                showError('Please select a file to upload.');
                return;
            }

            // Upload document to Firebase Storage
            uploadDocumentToFirebase(file, formData);
        });

        async function uploadDocumentToFirebase(file, formData) {
            try {
                showSuccess('Uploading document...');
                
                // Import Firebase modules
                const { initializeApp } = await import("https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js");
                const { getStorage, ref, uploadBytes, getDownloadURL } = await import("https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js");
                const { getAuth } = await import("https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js");
                
                // Firebase configuration (same as in the main script)
                const firebaseConfig = {
                    apiKey: "AIzaSyC0TdBjLeGimGoYZwLxzC4fQLPBdSzrT0A",
                    authDomain: "universityweb-19e1e.firebaseapp.com",
                    projectId: "universityweb-19e1e",
                    storageBucket: "universityweb-19e1e.firebasestorage.app",
                    messagingSenderId: "401942926589",
                    appId: "1:401942926589:web:c98e8d71ae6bd396775a94"
                };
                
                // Initialize Firebase app
                const app = initializeApp(firebaseConfig);
                const storage = getStorage(app);
                const auth = getAuth(app);
                
                // Create file reference
                const fileName = `${Date.now()}_${file.name}`;
                const fileRef = ref(storage, `documents/${fileName}`);
                
                // Upload file
                const snapshot = await uploadBytes(fileRef, file);
                const downloadURL = await getDownloadURL(snapshot.ref);
                
                // Save document metadata to Firestore
                await saveDocumentMetadata({
                    title: formData.get('title'),
                    description: formData.get('description'),
                    fileName: file.name,
                    fileUrl: downloadURL,
                    fileSize: file.size,
                    visible: formData.get('visible') === 'on',
                    uploadedAt: new Date(),
                    uploadedBy: auth.currentUser?.email || 'admin'
                });
                
                showSuccess('Document uploaded successfully!');
                closeDocumentModal();
                loadDocuments();
                
            } catch (error) {
                console.error('Error uploading document:', error);
                showError('Failed to upload document. Please try again.');
            }
        }

        async function saveDocumentMetadata(documentData) {
            const { initializeApp } = await import("https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js");
            const { getFirestore, collection, addDoc } = await import("https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js");
            
            // Firebase configuration (same as in the main script)
            const firebaseConfig = {
                apiKey: "AIzaSyC0TdBjLeGimGoYZwLxzC4fQLPBdSzrT0A",
                authDomain: "universityweb-19e1e.firebaseapp.com",
                projectId: "universityweb-19e1e",
                storageBucket: "universityweb-19e1e.firebasestorage.app",
                messagingSenderId: "401942926589",
                appId: "1:401942926589:web:c98e8d71ae6bd396775a94"
            };
            
            // Initialize Firebase app
            const app = initializeApp(firebaseConfig);
            const db = getFirestore(app);
            
            await addDoc(collection(db, 'documents'), documentData);
        }

        async function loadDocuments() {
            try {
                const { initializeApp } = await import("https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js");
                const { getFirestore, collection, getDocs, query, orderBy } = await import("https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js");
                
                // Firebase configuration
                const firebaseConfig = {
                    apiKey: "AIzaSyC0TdBjLeGimGoYZwLxzC4fQLPBdSzrT0A",
                    authDomain: "universityweb-19e1e.firebaseapp.com",
                    projectId: "universityweb-19e1e",
                    storageBucket: "universityweb-19e1e.firebasestorage.app",
                    messagingSenderId: "401942926589",
                    appId: "1:401942926589:web:c98e8d71ae6bd396775a94"
                };
                
                // Initialize Firebase app
                const app = initializeApp(firebaseConfig);
                const db = getFirestore(app);
                
                const documentsQuery = query(collection(db, 'documents'), orderBy('uploadedAt', 'desc'));
                const snapshot = await getDocs(documentsQuery);
                
                const documentsGrid = document.getElementById('documents-grid');
                documentsGrid.innerHTML = '';
                
                let totalDocuments = 0;
                let visibleDocuments = 0;
                
                // Process all documents
                const allDocuments = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                
                allDocuments.forEach(document => {
                    totalDocuments++;
                    if (document.visible) visibleDocuments++;
                    
                    createDocumentCard(document.id, document);
                });
                
                // Update stats
                document.getElementById('total-documents').textContent = totalDocuments;
                document.getElementById('visible-documents').textContent = visibleDocuments;
                
                if (totalDocuments === 0) {
                    documentsGrid.innerHTML = `
                        <div class="empty-state">
                            <div class="empty-icon">📄</div>
                            <h3>No Documents Found</h3>
                            <p>Upload your first company document to get started.</p>
                        </div>
                    `;
                }
                
            } catch (error) {
                console.error('Error loading documents:', error);
                showError('Failed to load documents.');
            }
        }

        function createDocumentCard(docId, document) {
            const documentsGrid = document.getElementById('documents-grid');
            
            const card = document.createElement('div');
            card.className = 'document-card';
            
            card.innerHTML = `
                <div class="document-header">
                    <h3 class="document-title">${document.title}</h3>
                    <span class="document-status ${document.visible ? 'visible' : 'hidden'}">
                        ${document.visible ? 'Visible' : 'Hidden'}
                    </span>
                </div>
                <div class="document-info">
                    <p><strong>File:</strong> ${document.fileName}</p>
                    <p><strong>Size:</strong> ${formatFileSize(document.fileSize)}</p>
                    <p><strong>Uploaded:</strong> ${new Date(document.uploadedAt.seconds * 1000).toLocaleDateString()}</p>
                    ${document.description ? `<p><strong>Description:</strong> ${document.description}</p>` : ''}
                </div>
                <div class="document-actions">
                    <button class="document-btn primary" onclick="downloadDocument('${document.fileUrl}', '${document.fileName}')">
                        📥 Download
                    </button>
                    <button class="document-btn ${document.visible ? 'secondary' : 'success'}" onclick="toggleDocumentVisibility('${docId}', ${!document.visible})">
                        ${document.visible ? '🙈 Hide' : '👁️ Show'}
                    </button>
                    <button class="document-btn danger" onclick="deleteDocument('${docId}', '${document.title}')">
                        🗑️ Delete
                    </button>
                </div>
            `;
            
            documentsGrid.appendChild(card);
        }

        function downloadDocument(fileUrl, fileName) {
            const link = document.createElement('a');
            link.href = fileUrl;
            link.download = fileName;
            link.target = '_blank';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        async function toggleDocumentVisibility(docId, visible) {
            try {
                const { initializeApp } = await import("https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js");
                const { getFirestore, doc, updateDoc } = await import("https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js");
                
                // Firebase configuration
                const firebaseConfig = {
                    apiKey: "AIzaSyC0TdBjLeGimGoYZwLxzC4fQLPBdSzrT0A",
                    authDomain: "universityweb-19e1e.firebaseapp.com",
                    projectId: "universityweb-19e1e",
                    storageBucket: "universityweb-19e1e.firebasestorage.app",
                    messagingSenderId: "401942926589",
                    appId: "1:401942926589:web:c98e8d71ae6bd396775a94"
                };
                
                // Initialize Firebase app
                const app = initializeApp(firebaseConfig);
                const db = getFirestore(app);
                
                await updateDoc(doc(db, 'documents', docId), {
                    visible: visible
                });
                
                showSuccess(`Document ${visible ? 'shown' : 'hidden'} successfully!`);
                loadDocuments();
                
            } catch (error) {
                console.error('Error updating document visibility:', error);
                showError('Failed to update document visibility.');
            }
        }

        async function deleteDocument(docId, title) {
            if (!confirm(`Are you sure you want to delete "${title}"? This action cannot be undone.`)) {
                return;
            }
            
            try {
                const { initializeApp } = await import("https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js");
                const { getFirestore, doc, deleteDoc } = await import("https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js");
                
                // Firebase configuration
                const firebaseConfig = {
                    apiKey: "AIzaSyC0TdBjLeGimGoYZwLxzC4fQLPBdSzrT0A",
                    authDomain: "universityweb-19e1e.firebaseapp.com",
                    projectId: "universityweb-19e1e",
                    storageBucket: "universityweb-19e1e.firebasestorage.app",
                    messagingSenderId: "401942926589",
                    appId: "1:401942926589:web:c98e8d71ae6bd396775a94"
                };
                
                // Initialize Firebase app
                const app = initializeApp(firebaseConfig);
                const db = getFirestore(app);
                
                await deleteDoc(doc(db, 'documents', docId));
                
                showSuccess('Document deleted successfully!');
                loadDocuments();
                
            } catch (error) {
                console.error('Error deleting document:', error);
                showError('Failed to delete document.');
            }
        }

        // Load email template
        function loadEmailTemplate() {
            const templateSelect = document.getElementById('email-template-select');
            const subjectInput = document.getElementById('email-subject');
            const messageTextarea = document.getElementById('email-message');
            
            const templates = {
                'interview-invitation': {
                    subject: 'Interview Invitation - {{position}}',
                    message: `Dear {{name}},

Thank you for your interest in the {{position}} position at our company. We were impressed with your application and would like to invite you for an interview.

Interview Details:
- Date: [Please specify]
- Time: [Please specify]
- Location/Link: [Please specify]

Please confirm your availability by replying to this email.

Best regards,
[Your Name]`
                },
                'application-received': {
                    subject: 'Application Received - {{position}}',
                    message: `Dear {{name}},

Thank you for applying for the {{position}} position. We have received your application and will review it carefully.

We will contact you within the next few days regarding the next steps in our hiring process.

Best regards,
[Your Name]`
                },
                'application-rejected': {
                    subject: 'Application Update - {{position}}',
                    message: `Dear {{name}},

Thank you for your interest in the {{position}} position and for taking the time to apply.

After careful consideration, we have decided to move forward with other candidates whose qualifications more closely match our current needs.

We appreciate your interest in our company and encourage you to apply for future opportunities.

Best regards,
[Your Name]`
                },
                'offer-letter': {
                    subject: 'Job Offer - {{position}}',
                    message: `Dear {{name}},

Congratulations! We are pleased to offer you the position of {{position}} at our company.

Please review the attached offer details and let us know if you have any questions.

We look forward to welcoming you to our team!

Best regards,
[Your Name]`
                }
            };
            
            const selectedTemplate = templates[templateSelect.value];
            if (selectedTemplate && window.currentApplication) {
                subjectInput.value = selectedTemplate.subject
                    .replace('{{position}}', window.currentApplication.position || 'Position')
                    .replace('{{name}}', window.currentApplication.fullName || 'Applicant');
                
                messageTextarea.value = selectedTemplate.message
                    .replace(/{{name}}/g, window.currentApplication.fullName || 'Applicant')
                    .replace(/{{position}}/g, window.currentApplication.position || 'Position');
            }
        }

        // Execute bulk action
        function executeBulkAction() {
            const selectedAction = document.getElementById('bulk-action-select').value;
            const selectedApplications = Array.from(document.querySelectorAll('.application-checkbox:checked'))
                .map(checkbox => checkbox.value);
            
            if (!selectedAction || selectedApplications.length === 0) {
                showError('Please select an action and at least one application.');
                return;
            }
            
            switch (selectedAction) {
                case 'review':
                    bulkStatusUpdate(selectedApplications, 'reviewing');
                    break;
                case 'interview':
                    bulkStatusUpdate(selectedApplications, 'interview');
                    break;
                case 'reject':
                    if (confirm(`Are you sure you want to reject ${selectedApplications.length} applications?`)) {
                        bulkStatusUpdate(selectedApplications, 'rejected');
                    }
                    break;
                case 'export':
                    exportSelectedApplications(selectedApplications);
                    break;
            }
            
            // Reset bulk actions
            document.getElementById('bulk-action-select').value = '';
            document.getElementById('select-all-applications').checked = false;
            document.querySelectorAll('.application-checkbox').forEach(cb => cb.checked = false);
            toggleBulkActions();
        }

        // Bulk status update
        function bulkStatusUpdate(applicationIds, newStatus) {
            let completed = 0;
            const total = applicationIds.length;
            
            applicationIds.forEach(appId => {
                quickStatusUpdate(appId, newStatus);
                completed++;
                
                if (completed === total) {
                    showSuccess(`Updated ${total} applications to ${newStatus}`);
                }
            });
        }

        // Export selected applications
        function exportSelectedApplications(applicationIds) {
            const selectedApps = allData.applications.filter(app => applicationIds.includes(app.id));
            
            if (selectedApps.length === 0) {
                showError('No applications selected for export.');
                return;
            }
            
            // Create CSV content
            const csvHeaders = ['Name', 'Email', 'Phone', 'Position', 'Status', 'Applied Date', 'Experience'];
            const csvData = [csvHeaders];
            
            selectedApps.forEach(app => {
                csvData.push([
                    app.fullName || 'Unknown',
                    app.email || 'No email',
                    app.phone || 'No phone',
                    app.position || 'Unknown Position',
                    app.status || 'pending',
                    app.createdAt ? new Date(app.createdAt.toDate()).toLocaleDateString() : 'Unknown',
                    (app.experience || 'Not provided').replace(/\n/g, ' ').substring(0, 100)
                ]);
            });
            
            // Convert to CSV string
            const csvContent = csvData.map(row => 
                row.map(cell => `"${String(cell).replace(/"/g, '""')}"`).join(',')
            ).join('\n');
            
            // Create and download file
            const blob = new Blob(['\ufeff' + csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `selected_applications_${new Date().toISOString().split('T')[0]}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showSuccess(`Exported ${selectedApps.length} applications to CSV`);
        }

        // Export all applications
        function exportApplications() {
            if (allData.applications.length === 0) {
                showError('No applications to export.');
                return;
            }
            
            exportSelectedApplications(allData.applications.map(app => app.id));
        }

        // Refresh applications
        function refreshApplications() {
            if (window.loadApplicationsData) {
                window.loadApplicationsData();
                showSuccess('Applications refreshed!');
            } else {
                showError('Unable to refresh applications. Please reload the page.');
            }
        }

        // Application Filter Functions (Global scope)
        
        // Populate position filter dropdown
        function populatePositionFilter() {
            const positionFilter = document.getElementById('position-filter');
            
            if (!positionFilter || !window.allData) return;
            
            // Get all job positions from careers section
            const jobPositions = window.allData.jobs.map(job => job.title).filter(title => title);
            
            // Get positions from applications that might not match job titles exactly
            const applicationPositions = window.allData.applications.map(app => app.position).filter(pos => pos);
            
            // Combine both lists and remove duplicates
            const allPositions = [...new Set([...jobPositions, ...applicationPositions])];
            
            // Clear existing options except "All Positions"
            positionFilter.innerHTML = '<option value="all">All Positions</option>';
            
            // Sort positions alphabetically
            allPositions.sort().forEach(position => {
                const option = document.createElement('option');
                option.value = position;
                
                // Count applications for this position
                const applicationCount = window.allData.applications.filter(app => 
                    app.position === position
                ).length;
                
                // Show position with application count
                option.textContent = `${position} (${applicationCount} applications)`;
                positionFilter.appendChild(option);
            });
        }

        // Filter applications by multiple criteria
        function filterApplications() {
            const statusFilter = document.getElementById('status-filter');
            const positionFilter = document.getElementById('position-filter');
            const dateFilter = document.getElementById('date-filter');
            const searchInput = document.getElementById('application-search');
            
            if (!statusFilter || !positionFilter || !dateFilter || !searchInput || !window.allData) {
                console.error('Filter elements or data not found');
                return;
            }
            
            const statusValue = statusFilter.value;
            const positionValue = positionFilter.value;
            const dateValue = dateFilter.value;
            const searchTerm = searchInput.value.toLowerCase();
            
            const rows = document.querySelectorAll('.application-row');
            let visibleCount = 0;
            
            rows.forEach(row => {
                const app = window.allData.applications.find(a => a.id === row.dataset.applicationId);
                if (!app) return;
                
                let shouldShow = true;
                
                // Status filter
                if (statusValue !== 'all') {
                    const appStatus = app.status || 'pending';
                    if (appStatus !== statusValue) shouldShow = false;
                }
                
                // Position filter
                if (positionValue !== 'all') {
                    const appPosition = app.position || 'Unknown Position';
                    if (appPosition !== positionValue) shouldShow = false;
                }
                
                // Date filter
                if (dateValue !== 'all' && app.createdAt) {
                    const appDate = app.createdAt.toDate();
                    const now = new Date();
                    
                    switch (dateValue) {
                        case 'today':
                            if (appDate.toDateString() !== now.toDateString()) shouldShow = false;
                            break;
                        case 'week':
                            const weekAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
                            if (appDate < weekAgo) shouldShow = false;
                            break;
                        case 'month':
                            const monthAgo = new Date(now.getTime() - 30 * 24 * 60 * 60 * 1000);
                            if (appDate < monthAgo) shouldShow = false;
                            break;
                    }
                }
                
                // Search filter
                if (searchTerm) {
                    const searchableText = [
                        app.fullName || '',
                        app.email || '',
                        app.position || '',
                        app.experience || '',
                        app.coverLetter || ''
                    ].join(' ').toLowerCase();
                    
                    if (!searchableText.includes(searchTerm)) shouldShow = false;
                }
                
                row.style.display = shouldShow ? '' : 'none';
                if (shouldShow) visibleCount++;
            });
            
            // Show/hide empty state
            const emptyState = document.getElementById('applications-empty-state');
            const tableContainer = document.querySelector('.applications-table-container');
            
            if (visibleCount === 0 && window.allData.applications.length > 0) {
                if (tableContainer) tableContainer.style.display = 'none';
                if (emptyState) {
                    emptyState.style.display = 'block';
                    const h3 = emptyState.querySelector('h3');
                    const p = emptyState.querySelector('p');
                    if (h3) h3.textContent = 'No Applications Match Filters';
                    if (p) p.textContent = 'Try adjusting your filters to see more results.';
                }
            } else if (window.allData.applications.length === 0) {
                if (tableContainer) tableContainer.style.display = 'none';
                if (emptyState) {
                    emptyState.style.display = 'block';
                    const h3 = emptyState.querySelector('h3');
                    const p = emptyState.querySelector('p');
                    if (h3) h3.textContent = 'No Applications Found';
                    if (p) p.textContent = 'No job applications match your current filters.';
                }
            } else {
                if (tableContainer) tableContainer.style.display = 'block';
                if (emptyState) emptyState.style.display = 'none';
            }
        }

        // Search applications
        function searchApplications() {
            filterApplications();
        }

        // Clear all filters
        function clearApplicationFilters() {
            const statusFilter = document.getElementById('status-filter');
            const positionFilter = document.getElementById('position-filter');
            const dateFilter = document.getElementById('date-filter');
            const searchInput = document.getElementById('application-search');
            
            if (statusFilter) statusFilter.value = 'all';
            if (positionFilter) positionFilter.value = 'all';
            if (dateFilter) dateFilter.value = 'all';
            if (searchInput) searchInput.value = '';
            
            filterApplications();
        }

        // Action functions for onclick handlers (Global scope)
        function openAddModal(type) {
            if (window.getFormFields) {
                window.currentItemType = type;
                window.currentItemId = null;
                document.getElementById('modal-title').textContent = `Add New ${type.charAt(0).toUpperCase() + type.slice(1, -1)}`;
                
                document.getElementById('form-fields').innerHTML = window.getFormFields(type);
                document.getElementById('modal').style.display = 'block';
                
                if (window.setupImagePreview) {
                    window.setupImagePreview();
                }
            } else {
                showError('Admin system not ready. Please reload the page.');
            }
        }

        function editItem(type, id) {
            if (!window.allData || !window.allData[type]) {
                showError('Data not loaded yet. Please wait or reload the page.');
                return;
            }

            window.currentItemType = type;
            window.currentItemId = id;
            const item = window.allData[type].find(item => item.id === id);
            
            if (!item) {
                showError('Item not found. Please refresh and try again.');
                return;
            }

            document.getElementById('modal-title').textContent = `Edit ${type.charAt(0).toUpperCase() + type.slice(1, -1)}`;
            
            if (window.getFormFields) {
                document.getElementById('form-fields').innerHTML = window.getFormFields(type, item);
                document.getElementById('modal').style.display = 'block';
                
                if (window.setupImagePreview) {
                    window.setupImagePreview();
                }
            } else {
                showError('Form configuration not available. Please reload the page.');
            }
        }

        function deleteItem(type, id) {
            if (!window.allData || !window.allData[type]) {
                showError('Data not loaded yet. Please wait or reload the page.');
                return;
            }

            if (confirm('Are you sure you want to delete this item?')) {
                const item = window.allData[type].find(item => item.id === id);
                const itemName = item ? (item.name || item.title || item.author || item.fullName || 'Unknown Item') : 'Unknown Item';
                
                // Call Firebase delete function if available
                if (window.deleteDoc && window.doc && window.db) {
                    window.deleteDoc(window.doc(window.db, type, id)).then(() => {
                        // Log activity if ActivityLogger is available
                        if (window.ActivityLogger && window.ActivityLogger.logActivity) {
                            window.ActivityLogger.logActivity(
                                'DELETE',
                                type.toUpperCase(),
                                itemName,
                                {
                                    itemId: id,
                                    deletedData: item
                                }
                            );
                        }
                        showSuccess('Item deleted successfully!');
                    }).catch(error => {
                        console.error('Delete error:', error);
                        showError('Could not delete item. Please try again.');
                    });
                } else {
                    showError('Delete function not available. Please reload the page.');
                }
            }
        }

        function closeModal() {
            document.getElementById('modal').style.display = 'none';
            if (window.currentItemId !== undefined) window.currentItemId = null;
            if (window.currentItemType !== undefined) window.currentItemType = null;
        }

        // Toggle visibility functions
        function toggleTestimonialVisibility(id, currentStatus) {
            toggleItemVisibility('testimonials', id, currentStatus);
        }

        function toggleJobVisibility(id, currentStatus) {
            toggleItemVisibility('jobs', id, currentStatus);
        }

        function toggleFounderVisibility(id, currentStatus) {
            toggleItemVisibility('founders', id, currentStatus);
        }

        function toggleGalleryVisibility(id, currentStatus) {
            toggleItemVisibility('gallery', id, currentStatus);
        }

        // Generic toggle visibility function
        function toggleItemVisibility(type, id, currentStatus) {
            if (!window.allData || !window.allData[type]) {
                showError('Data not loaded yet. Please wait or reload the page.');
                return;
            }

            const newStatus = currentStatus === 'visible' ? 'hidden' : 'visible';
            const item = window.allData[type].find(item => item.id === id);
            const itemName = item ? (item.name || item.title || item.author || 'Unknown Item') : 'Unknown Item';
            
            // Call Firebase update function if available
            if (window.updateDoc && window.doc && window.db && window.serverTimestamp) {
                window.updateDoc(window.doc(window.db, type, id), {
                    status: newStatus,
                    updatedAt: window.serverTimestamp()
                }).then(() => {
                    // Log activity if ActivityLogger is available
                    if (window.ActivityLogger && window.ActivityLogger.logActivity) {
                        window.ActivityLogger.logActivity(
                            'STATUS_CHANGE',
                            type.toUpperCase(),
                            itemName,
                            {
                                itemId: id,
                                action: 'visibility_toggle',
                                from: currentStatus,
                                to: newStatus
                            }
                        );
                    }
                    showSuccess(`${type.charAt(0).toUpperCase() + type.slice(1, -1)} is now ${newStatus}!`);
                }).catch(error => {
                    console.error('Toggle error:', error);
                    showError(`Could not update ${type.slice(0, -1)}. Please try again.`);
                });
            } else {
                showError('Update function not available. Please reload the page.');
            }
        }

        // Image preview setup function
        function setupImagePreview() {
            const imageInputs = document.querySelectorAll('input[name="imageUrl"]');
            imageInputs.forEach(input => {
                input.addEventListener('input', function() {
                    const previewContainer = document.getElementById('image-preview-container');
                    if (this.value && previewContainer) {
                        previewContainer.innerHTML = `<img src="${this.value}" alt="Preview" class="image-preview" onerror="this.style.display='none'">`;
                    }
                });
            });
        }

        // Tab switching
        function switchTab(tabName) {
            // Hide all sections
            document.querySelectorAll('.content-section').forEach(section => {
                section.style.display = 'none';
            });
            
            // Remove active class from all tabs
            document.querySelectorAll('.sidebar-menu a').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected section
            document.getElementById(tabName + '-section').style.display = 'block';
            
            // Add active class to selected tab
            document.getElementById(tabName + '-tab').classList.add('active');
            
            // Load data for specific tabs
            if (tabName === 'admin-management') {
                loadAdminList();
            } else if (tabName === 'documents') {
                loadDocuments();
            }
            
            // Close sidebar on mobile
            if (window.innerWidth <= 768) {
                closeSidebar();
            }
        }

        // Toggle sidebar
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const hamburger = document.getElementById('hamburger');
            const overlay = document.getElementById('sidebar-overlay');
            
            sidebar.classList.toggle('open');
            hamburger.classList.toggle('active');
            
            if (window.innerWidth <= 768) {
                overlay.classList.toggle('show');
                document.body.style.overflow = sidebar.classList.contains('open') ? 'hidden' : '';
            }
        }

        // Close sidebar
        function closeSidebar() {
            const sidebar = document.getElementById('sidebar');
            const hamburger = document.getElementById('hamburger');
            const overlay = document.getElementById('sidebar-overlay');
            
            sidebar.classList.remove('open');
            hamburger.classList.remove('active');
            overlay.classList.remove('show');
            document.body.style.overflow = '';
        }

        // Close sidebar when clicking outside
        document.addEventListener('click', function(event) {
            const sidebar = document.getElementById('sidebar');
            const mobileMenuBtn = document.getElementById('mobileMenuBtn');
            
            if (window.innerWidth <= 768 && 
                !sidebar.contains(event.target) && 
                !mobileMenuBtn.contains(event.target)) {
                closeSidebar();
            }
        });

        // Close sidebar with Escape key
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape' && window.innerWidth <= 768) {
                const sidebar = document.getElementById('sidebar');
                if (sidebar.classList.contains('open')) {
                    closeSidebar();
                }
            }
        });

        // CV Management Functions - Global scope
        function viewCV(cvUrl, fileName) {
            if (!cvUrl) {
                showError('CV file not available');
                return;
            }
            
            // Open CV in new tab/window
            const newWindow = window.open(cvUrl, '_blank');
            if (!newWindow) {
                // If popup blocked, show download option
                showError('Popup blocked. CV will be downloaded instead.');
                downloadCV(cvUrl, fileName);
            }
        }

        function downloadCV(cvUrl, fileName) {
            if (!cvUrl) {
                showError('CV file not available');
                return;
            }
            
            try {
                // Create a temporary link element
                const link = document.createElement('a');
                link.href = cvUrl;
                link.download = fileName || 'CV.pdf';
                link.target = '_blank';
                
                // Append to body, click, and remove
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                showSuccess(`CV "${fileName}" download started`);
            } catch (error) {
                console.error('Download error:', error);
                showError('Failed to download CV. Please try again.');
            }
        }

        // Close modal when clicking outside
        document.getElementById('modal').addEventListener('click', function(event) {
            if (event.target === this) {
                closeModal();
            }
        });

        // Close email config modal when clicking outside
        document.getElementById('email-config-modal').addEventListener('click', function(event) {
            if (event.target === this) {
                closeEmailConfigModal();
            }
        });

        // Close application detail modal when clicking outside
        document.getElementById('application-detail-modal').addEventListener('click', function(event) {
            if (event.target === this) {
                closeApplicationDetailModal();
            }
        });

        // Close interview modal when clicking outside
        document.getElementById('interview-modal').addEventListener('click', function(event) {
            if (event.target === this) {
                closeInterviewModal();
            }
        });

        // Close email template modal when clicking outside
        document.getElementById('email-template-modal').addEventListener('click', function(event) {
            if (event.target === this) {
                closeEmailTemplateModal();
            }
        });

        // Close document modal when clicking outside
        document.getElementById('document-modal').addEventListener('click', function(event) {
            if (event.target === this) {
                closeDocumentModal();
            }
        });

        // Interview form submission
        document.getElementById('interview-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            if (!window.currentApplication) {
                showError('No application selected.');
                return;
            }
            
            const formData = new FormData(this);
            const interviewData = Object.fromEntries(formData.entries());
            
            // Here you would typically save the interview data to Firebase
            // For now, we'll just update the application status and log the activity
            
            quickStatusUpdate(window.currentApplication.id, 'interview');
            
            if (window.ActivityLogger) {
                ActivityLogger.logActivity(
                    'INTERVIEW_SCHEDULED',
                    'APPLICATION',
                    window.currentApplication.fullName || 'Unknown Applicant',
                    {
                        applicationId: window.currentApplication.id,
                        interviewType: interviewData.interviewType,
                        interviewDate: interviewData.interviewDate,
                        interviewTime: interviewData.interviewTime
                    }
                );
            }
            
            showSuccess('Interview scheduled successfully!');
            closeInterviewModal();
        });

        // Email template form submission
        document.getElementById('email-template-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            if (!window.currentApplication) {
                showError('No application selected.');
                return;
            }
            
            const formData = new FormData(this);
            const emailData = Object.fromEntries(formData.entries());
            
            // Here you would typically send the email using EmailJS or another service
            // For now, we'll just log the activity
            
            if (window.ActivityLogger) {
                ActivityLogger.logActivity(
                    'EMAIL_SENT',
                    'APPLICATION',
                    window.currentApplication.fullName || 'Unknown Applicant',
                    {
                        applicationId: window.currentApplication.id,
                        emailSubject: emailData.subject,
                        emailPreview: emailData.message.substring(0, 100)
                    }
                );
            }
            
            showSuccess('Email sent successfully!');
            closeEmailTemplateModal();
        });

        // Admin Management Functions (Global scope)
        
        // Initialize admin data structure safely
        if (!window.allData) {
            window.allData = {};
        }
        if (!window.allData.admins) {
            window.allData.admins = [];
        }

        // Helper function to ensure admin data structure
        function ensureAdminDataStructure() {
            if (!window.allData) {
                window.allData = {};
            }
            if (!window.allData.admins) {
                window.allData.admins = [];
            }
        }

        // Show/hide add admin form
        function openAddAdminModal() {
            const formCard = document.getElementById('add-admin-form-card');
            formCard.style.display = 'block';
            document.getElementById('admin-name').focus();
        }

        function hideAddAdminForm() {
            const formCard = document.getElementById('add-admin-form-card');
            formCard.style.display = 'none';
            document.getElementById('add-admin-form').reset();
        }

        // Create new admin user
        async function createAdminUser(name, email, password, role) {
            try {
                // Check if Firebase is initialized
                if (!window.auth || !window.db || !window.addDoc || !window.collection) {
                    throw new Error('Firebase not fully initialized. Please refresh the page and try again.');
                }

                // Import createUserWithEmailAndPassword if not available
                if (!window.createUserWithEmailAndPassword) {
                    const { createUserWithEmailAndPassword } = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js');
                    window.createUserWithEmailAndPassword = createUserWithEmailAndPassword;
                }

                // Import updateProfile if not available
                if (!window.updateProfile) {
                    const { updateProfile } = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js');
                    window.updateProfile = updateProfile;
                }

                // Create user with email and password
                const userCredential = await window.createUserWithEmailAndPassword(window.auth, email, password);
                const user = userCredential.user;

                // Update user profile with display name
                await window.updateProfile(user, {
                    displayName: name
                });

                // Admin created in Firebase Auth only - no Firestore storage
                console.log('Admin user created in Firebase Auth only:', {
                    uid: user.uid,
                    name: name,
                    email: email,
                    displayName: user.displayName
                });

                // Log the activity
                if (window.ActivityLogger) {
                    window.ActivityLogger.logActivity(
                        'ADMIN_CREATED',
                        'USER_MANAGEMENT',
                        name,
                        {
                            email: email,
                            role: role,
                            uid: user.uid
                        }
                    );
                }

                showSuccess(`Administrator ${name} created successfully!`);
                hideAddAdminForm();
                refreshAdminList();
                updateAdminStats();

                return user;
            } catch (error) {
                console.error('Error creating admin user:', error);
                let errorMessage = 'Failed to create administrator. ';
                
                switch (error.code) {
                    case 'auth/email-already-in-use':
                        errorMessage += 'Email address is already in use.';
                        break;
                    case 'auth/invalid-email':
                        errorMessage += 'Invalid email address.';
                        break;
                    case 'auth/weak-password':
                        errorMessage += 'Password is too weak. Use at least 6 characters.';
                        break;
                    default:
                        errorMessage += error.message;
                }
                
                showError(errorMessage);
                throw error;
            }
        }

        // Load admin list - Firebase Auth only (shows current user)
        async function loadAdminList() {
            try {
                // Wait for Firebase Auth to initialize
                if (!window.auth) {
                    console.log('Waiting for Firebase Auth initialization...');
                    await new Promise(resolve => setTimeout(resolve, 1000));
                }

                // Check again after waiting
                if (!window.auth) {
                    throw new Error('Firebase Auth not initialized. Please refresh the page.');
                }

                console.log('Loading current admin info from Firebase Auth...');
                
                // Ensure data structure exists
                ensureAdminDataStructure();
                
                // Show only current user since Firebase Auth doesn't allow client-side user listing
                const currentUser = window.auth.currentUser;
                if (currentUser) {
                    window.allData.admins = [{
                        id: currentUser.uid,
                        uid: currentUser.uid,
                        name: currentUser.displayName || 'Current Admin',
                        email: currentUser.email,
                        role: 'admin',
                        status: 'active',
                        createdAt: { toDate: () => new Date(currentUser.metadata.creationTime) },
                        lastLogin: { toDate: () => new Date(currentUser.metadata.lastSignInTime) },
                        isCurrent: true
                    }];
                    console.log('Loaded current admin info:', currentUser.email);
                } else {
                    window.allData.admins = [];
                    console.log('No current user found');
                }

                renderAdminList();
                updateAdminStats();
            } catch (error) {
                console.error('Error loading admin info:', error);
                showError('Failed to load administrator information. Please refresh the page and try again.');
            }
        }

        // Render admin list table
        function renderAdminList() {
            const tableBody = document.getElementById('admin-table-body');
            const emptyState = document.getElementById('admin-empty-state');
            
            // Ensure data structure exists
            if (!window.allData) {
                window.allData = {};
            }
            if (!window.allData.admins) {
                window.allData.admins = [];
            }
            
            if (window.allData.admins.length === 0) {
                tableBody.innerHTML = '';
                emptyState.style.display = 'block';
                return;
            }

            emptyState.style.display = 'none';
            tableBody.innerHTML = '';

            window.allData.admins.forEach(admin => {
                const row = document.createElement('tr');
                
                // Generate avatar initials
                const initials = admin.name ? admin.name.split(' ').map(n => n[0]).join('').toUpperCase() : '?';
                
                // Format dates
                const createdDate = admin.createdAt ? 
                    new Date(admin.createdAt.toDate()).toLocaleDateString() : 'Unknown';
                const lastLogin = admin.lastLogin ? 
                    new Date(admin.lastLogin.toDate()).toLocaleDateString() : 'Never';

                // Special styling for current user
                const currentUserBadge = admin.isCurrent ? '<span style="color: #0073e6; font-weight: bold;"> (You)</span>' : '';

                row.innerHTML = `
                    <td>
                        <div class="admin-info-cell">
                            <div class="admin-avatar">${initials}</div>
                            <div class="admin-details">
                                <div class="admin-name">${admin.name || 'Unknown'}${currentUserBadge}</div>
                            </div>
                        </div>
                    </td>
                    <td>
                        <div class="admin-email">${admin.email || 'Unknown'}</div>
                    </td>
                    <td>
                        <span class="role-badge role-${admin.role || 'admin'}">${admin.role || 'admin'}</span>
                    </td>
                    <td>${createdDate}</td>
                    <td>${lastLogin}</td>
                    <td>
                        <span class="admin-status status-${admin.status || 'active'}">${admin.status || 'active'}</span>
                    </td>
                    <td>
                        <div class="admin-actions">
                            ${admin.isCurrent ? 
                                '<span style="color: #666; font-size: 12px;">Current User</span>' :
                                `<button class="admin-action-btn admin-reset-password" onclick="resetAdminPassword('${admin.id}')" title="Reset Password">
                                    🔑
                                </button>
                                <button class="admin-action-btn admin-delete" onclick="deleteAdmin('${admin.id}')" title="Delete Admin">
                                    🗑️
                                </button>`
                            }
                        </div>
                    </td>
                `;

                tableBody.appendChild(row);
            });
        }

        // Update admin statistics
        function updateAdminStats() {
            // Ensure data structure exists
            if (!window.allData) {
                window.allData = {};
            }
            if (!window.allData.admins) {
                window.allData.admins = [];
            }

            const totalAdmins = window.allData.admins.length;
            const activeAdmins = window.allData.admins.filter(admin => admin.status === 'active').length;
            
            // Calculate recent admins (this month)
            const thisMonth = new Date();
            thisMonth.setDate(1);
            const recentAdmins = window.allData.admins.filter(admin => {
                if (!admin.createdAt) return false;
                const createdDate = admin.createdAt.toDate ? admin.createdAt.toDate() : new Date(admin.createdAt);
                return createdDate >= thisMonth;
            }).length;

            document.getElementById('total-admins').textContent = totalAdmins;
            document.getElementById('active-admins').textContent = activeAdmins;
            document.getElementById('recent-admins').textContent = recentAdmins;
        }

        // Refresh admin list
        function refreshAdminList() {
            loadAdminList();
            showSuccess('Administrator list refreshed!');
        }

        // Edit admin (placeholder for now)
        function editAdmin(adminId) {
            showError('Edit admin functionality coming soon!');
        }

        // Reset admin password
        async function resetAdminPassword(adminId) {
            // Ensure data structure exists
            if (!window.allData || !window.allData.admins) {
                showError('Admin data not loaded. Please refresh the page.');
                return;
            }

            const admin = window.allData.admins.find(a => a.id === adminId);
            if (!admin) {
                showError('Administrator not found.');
                return;
            }

            if (confirm(`Reset password for ${admin.name}? They will need to use password reset.`)) {
                try {
                    // Import sendPasswordResetEmail if not available
                    if (!window.sendPasswordResetEmail) {
                        const { sendPasswordResetEmail } = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js');
                        window.sendPasswordResetEmail = sendPasswordResetEmail;
                    }

                    await window.sendPasswordResetEmail(window.auth, admin.email);
                    
                    // Log the activity
                    if (window.ActivityLogger) {
                        window.ActivityLogger.logActivity(
                            'PASSWORD_RESET',
                            'USER_MANAGEMENT',
                            admin.name,
                            {
                                email: admin.email,
                                adminId: adminId
                            }
                        );
                    }

                    showSuccess(`Password reset email sent to ${admin.email}`);
                } catch (error) {
                    console.error('Error sending password reset:', error);
                    showError('Failed to send password reset email.');
                }
            }
        }

        // Delete admin - Firebase Auth only approach
        async function deleteAdmin(adminId) {
            // Check if trying to delete current user
            if (adminId === window.auth.currentUser?.uid) {
                showError('You cannot delete your own account while logged in.');
                return;
            }

            showError('Deleting Firebase Auth users requires server-side implementation with Firebase Admin SDK. This feature is not available in client-side code for security reasons.');
            
            // Note: To delete Firebase Auth users, you need:
            // 1. Firebase Admin SDK on your server
            // 2. Server endpoint to handle user deletion
            // 3. Proper authentication and authorization
        }

        // Search admins function removed - only showing current user in Firebase Auth only mode

        // Add admin form submission handler
        document.getElementById('add-admin-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const name = formData.get('name');
            const email = formData.get('email');
            const password = formData.get('password');
            const role = formData.get('role');
            
            if (!name || !email || !password || !role) {
                showError('Please fill in all required fields.');
                return;
            }

            try {
                await createAdminUser(name, email, password, role);
            } catch (error) {
                // Error already handled in createAdminUser
            }
        });

        // Admin search removed - only showing current user in Firebase Auth only mode

        // Global activity log filter function
        function filterActivityLogs() {
            const activityFilter = document.getElementById('activity-filter').value;
            const dateFilter = document.getElementById('date-filter').value;
            const tableBody = document.getElementById('activity-table-body');
            const rows = tableBody.querySelectorAll('tr');
            
            rows.forEach(row => {
                // Skip empty state row
                if (row.children.length === 1) return;
                
                let showRow = true;
                
                // Activity filter
                if (activityFilter !== 'all') {
                    const actionBadge = row.querySelector('.activity-action-badge');
                    if (actionBadge) {
                        const action = actionBadge.textContent.toLowerCase();
                        if (activityFilter === 'login' && action !== 'login' && action !== 'logout') {
                            showRow = false;
                        } else if (activityFilter === 'create' && action !== 'create') {
                            showRow = false;
                        } else if (activityFilter === 'update' && action !== 'update') {
                            showRow = false;
                        } else if (activityFilter === 'delete' && action !== 'delete') {
                            showRow = false;
                        } else if (activityFilter === 'status' && action !== 'status_change') {
                            showRow = false;
                        }
                    }
                }
                
                // Date filter
                if (dateFilter !== 'all' && showRow) {
                    const timeCell = row.querySelector('.activity-time');
                    if (timeCell) {
                        const rowDate = new Date(timeCell.textContent);
                        const now = new Date();
                        
                        if (dateFilter === 'today') {
                            const today = new Date();
                            today.setHours(0, 0, 0, 0);
                            rowDate.setHours(0, 0, 0, 0);
                            if (rowDate.getTime() !== today.getTime()) {
                                showRow = false;
                            }
                        } else if (dateFilter === 'week') {
                            const weekAgo = new Date();
                            weekAgo.setDate(weekAgo.getDate() - 7);
                            if (rowDate < weekAgo) {
                                showRow = false;
                            }
                        } else if (dateFilter === 'month') {
                            const monthAgo = new Date();
                            monthAgo.setMonth(monthAgo.getMonth() - 1);
                            if (rowDate < monthAgo) {
                                showRow = false;
                            }
                        }
                    }
                }
                
                row.style.display = showRow ? '' : 'none';
            });
        }

        // Firebase Auth only - no collection management needed
    </script>
</body>
</html>
